<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>librsb: Example programs and code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">librsb
   &#160;<span id="projectnumber">1.3.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">Example programs and code</div>  </div>
</div><!--header-->
<div class="contents">

<p>Examples of usage of <code>librsb</code> in C (&lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt; and &lt;<a class="el" href="blas__sparse_8h.html" title="This file specifies the Sparse BLAS interface to librsb. Supported types :(float,double,float complex,double complex) . Unsupported types:() . Level 1 ops :(dot,axpy,ga,gz,sc) . Level 2 ops :(mv,sv) . Level 3 ops :(mm,sm) . ">blas_sparse.h</a>&gt;), C++ (optional &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt;), Fortran (&lt;<a class="el" href="rsb_8F90.html" title="Header file automatically generated from &lt;rsb.h&gt;, offering ISO-C-BINDING interfaces to &lt;rsb...">rsb.F90</a>&gt; and &lt;<a class="el" href="rsb__blas__sparse_8F90.html" title="Implementation of the Fortran Sparse BLAS interface to librsb (see The Sparse BLAS interface to librs...">rsb_blas_sparse.F90</a>&gt;).  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:assemble_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="assemble_8cpp.html">assemble.cpp</a></td></tr>
<tr class="memdesc:assemble_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; assembling <a class="el" href="classRsbMatrix.html" title="Represent a sparse matrix in RSB format by means of librsb. ">RsbMatrix</a> by pieces. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:autotune_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="autotune_8cpp.html">autotune.cpp</a></td></tr>
<tr class="memdesc:autotune_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; for performance-benchmarking a matrix from file using <a class="el" href="classRsbMatrix.html#a789dabdb1d2ad4962fe5c38829415741">RsbMatrix.tune_spmm()</a>, for various right-hand side counts. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:bench_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bench_8cpp.html">bench.cpp</a></td></tr>
<tr class="memdesc:bench_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; for performance-benchmarking a matrix from file using <a class="el" href="classRsbMatrix.html#a0762858062a9aed3203f628e47fb99ba">RsbMatrix.spmm()</a>, for various right-hand side counts. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:build_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="build_8cpp.html">build.cpp</a></td></tr>
<tr class="memdesc:build_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; using timings for common matrix operations on <a class="el" href="classRsbMatrix.html" title="Represent a sparse matrix in RSB format by means of librsb. ">RsbMatrix</a>: <a class="el" href="classRsbMatrix.html#a4f40c66684a92eadbb06f8fc515957e1">RsbMatrix.get_coo()</a>, <a class="el" href="group__rsb__doc__rsb.html#gaa09eca432d5bb8c57fcff5d9ab98dfb8">rsb_coo_sort()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:example_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="example_8cpp.html">example.cpp</a></td></tr>
<tr class="memdesc:example_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; using <a class="el" href="classRsbMatrix.html#a0762858062a9aed3203f628e47fb99ba">RsbMatrix.spmm()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:misc_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="misc_8cpp.html">misc.cpp</a></td></tr>
<tr class="memdesc:misc_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; showing various <a class="el" href="classRsbMatrix.html" title="Represent a sparse matrix in RSB format by means of librsb. ">RsbMatrix</a> operations. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:mtx2bin_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mtx2bin_8cpp.html">mtx2bin.cpp</a></td></tr>
<tr class="memdesc:mtx2bin_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; converting a Matrix Market file into a custom format using <a class="el" href="classRsbMatrix.html#a4f40c66684a92eadbb06f8fc515957e1">RsbMatrix.get_coo()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:render_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="render_8cpp.html">render.cpp</a></td></tr>
<tr class="memdesc:render_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; of invoking the autotuner on an <a class="el" href="classRsbMatrix.html" title="Represent a sparse matrix in RSB format by means of librsb. ">RsbMatrix</a> matrix with <a class="el" href="classRsbMatrix.html#a789dabdb1d2ad4962fe5c38829415741">RsbMatrix.tune_spmm()</a> and rendering it with <a class="el" href="classRsbMatrix.html#a62210120d77ff7ba63bacbe18427a3b0">RsbMatrix.rndr()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:span_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="span_8cpp.html">span.cpp</a></td></tr>
<tr class="memdesc:span_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; illustrating use of <a class="el" href="classRsbMatrix.html#a6812c6a07c45e3b6ce18822ac9d33745">RsbMatrix.file_save()</a>, and std::span-based versions of <a class="el" href="classRsbMatrix.html#a789dabdb1d2ad4962fe5c38829415741">RsbMatrix.tune_spmm()</a>, <a class="el" href="classRsbMatrix.html#a02fb375f9104f2fe8e523b4776d44ec1">RsbMatrix.spmv()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:twonnz_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="twonnz_8cpp.html">twonnz.cpp</a></td></tr>
<tr class="memdesc:twonnz_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ example based on &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt; measuring <a class="el" href="classRsbMatrix.html#a0762858062a9aed3203f628e47fb99ba">RsbMatrix.spmm()</a> performance of a matrix with only two elements; this is is effectively measuring performance of result vector scaling. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:autotune_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="autotune_8c.html">autotune.c</a></td></tr>
<tr class="memdesc:autotune_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">C "RSB autotune" example program based on &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;. uses <a class="el" href="group__rsb__doc__rsb.html#ga00833b0cf57da8e430f9d0e2b5375bb3">rsb_file_mtx_load()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga3ec8d721b5333aae6ea9b03eb0039285">rsb_spmm()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga8c11024d248e2e686476fd9e89aa7c15">rsb_tune_spmm()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:backsolve_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="backsolve_8c.html">backsolve.c</a></td></tr>
<tr class="memdesc:backsolve_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">C triangular solve example program. Uses <a class="el" href="group__rsb__doc__rsb.html#ga9b044332b720d3f8083ae792068fb04a">rsb_spsv()</a>,<a class="el" href="group__rsb__doc__rsb.html#ga8d7a05bbc165bd6ac20e8e23487a5871">rsb_tune_spsm()</a>. Based on &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:cplusplus_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cplusplus_8cpp.html">cplusplus.cpp</a></td></tr>
<tr class="memdesc:cplusplus_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">C++ program using the C &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt; interface. Uses <a class="el" href="group__rsb__doc__rsb.html#ga8c11024d248e2e686476fd9e89aa7c15">rsb_tune_spmm()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga4a16a82d289c76a437915db449553d4d">rsb_spmv()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:hello-spblas_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hello-spblas_8c.html">hello-spblas.c</a></td></tr>
<tr class="memdesc:hello-spblas_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">A first C "hello RSB" example program using a Sparse BLAS interface and &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;. Uses <a class="el" href="group__rsb__doc__sparse__blas.html#gac931dcb1129ee3016ab82602c3d14fee">BLAS_duscr_begin()</a>, <a class="el" href="blas__sparse_8h.html#a6719ae77dfef6d6dd0790e34a65c1924">BLAS_ussp()</a>, <a class="el" href="blas__sparse_8h.html#a5eec91b6d95962811bd9cb4e37266214">BLAS_usgp()</a>, <a class="el" href="group__rsb__doc__sparse__blas.html#gae0683bc8f0af5dd3e53b964190f9e1b4">BLAS_duscr_insert_entries()</a>, <a class="el" href="group__rsb__doc__sparse__blas.html#ga5d9ce97bf054b1e3750eaae5d4e6c335">BLAS_duscr_end()</a>, <a class="el" href="group__rsb__doc__sparse__blas.html#ga7cdfc09a860b29267539c4868f41ec51">BLAS_dusget_element()</a>,<a class="el" href="group__rsb__doc__sparse__blas.html#gad018cf218c2c938bb5cf4577f1b53319">BLAS_dusmv()</a>,<a class="el" href="group__rsb__doc__sparse__blas.html#ga8b0cca8196f40f7b55084a978b40717f">BLAS_usds()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:hello_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hello_8c.html">hello.c</a></td></tr>
<tr class="memdesc:hello_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">A first "hello RSB" example C program based on &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;. Uses <a class="el" href="group__rsb__doc__rsb.html#ga2a08c5a23f3999fe8cf36440680e4a05">rsb_lib_set_opt()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga2b7d51b9822f73d2fe7fcf5b9d0be1e9">rsb_mtx_get_info_str()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:io-spblas_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io-spblas_8c.html">io-spblas.c</a></td></tr>
<tr class="memdesc:io-spblas_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Example C program using the Sparse BLAS interface and reading from file using <a class="el" href="group__rsb__doc__sparse__blas.html#ga144b8e13c62a239a3097256af7c09fcb">rsb_blas_file_mtx_load()</a>, <a class="el" href="blas__sparse_8h.html#a5eec91b6d95962811bd9cb4e37266214">BLAS_usgp()</a>, <a class="el" href="group__rsb__doc__sparse__blas.html#gad018cf218c2c938bb5cf4577f1b53319">BLAS_dusmv()</a>, <a class="el" href="group__rsb__doc__sparse__blas.html#ga8b0cca8196f40f7b55084a978b40717f">BLAS_usds()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:power_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="power_8c.html">power.c</a></td></tr>
<tr class="memdesc:power_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">A toy &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;-based C program implementing the power method for computing matrix eigenvalues. Uses <a class="el" href="group__rsb__doc__rsb.html#ga4a16a82d289c76a437915db449553d4d">rsb_spmv()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:snippets_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="snippets_8c.html">snippets.c</a></td></tr>
<tr class="memdesc:snippets_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Collection of C snippets of other examples. Used piecewise the documentation. Not intended to be read as example. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:transpose_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transpose_8c.html">transpose.c</a></td></tr>
<tr class="memdesc:transpose_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">A toy &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;-based C program showing instantiation, transposition and other operations on a single matrix. Uses <a class="el" href="group__rsb__doc__rsb.html#gae181671ba19191caa5a282cbde4fdfc5">rsb_mtx_clone()</a>, <a class="el" href="group__rsb__doc__rsb.html#gad911ac7528c95c874d02cb17e6b76c54">rsb_file_mtx_save()</a>, <a class="el" href="group__rsb__doc__rsb.html#gaa79f69918eafbd8f737b7866a00a0330">rsb_file_mtx_get_dims()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga00833b0cf57da8e430f9d0e2b5375bb3">rsb_file_mtx_load()</a>. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Examples of usage of <code>librsb</code> in C (&lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt; and &lt;<a class="el" href="blas__sparse_8h.html" title="This file specifies the Sparse BLAS interface to librsb. Supported types :(float,double,float complex,double complex) . Unsupported types:() . Level 1 ops :(dot,axpy,ga,gz,sc) . Level 2 ops :(mv,sv) . Level 3 ops :(mm,sm) . ">blas_sparse.h</a>&gt;), C++ (optional &lt;<a class="el" href="rsb_8hpp.html" title="Classes RsbLib and RsbMatrix provide native C++ access to librsb. ">rsb.hpp</a>&gt;), Fortran (&lt;<a class="el" href="rsb_8F90.html" title="Header file automatically generated from &lt;rsb.h&gt;, offering ISO-C-BINDING interfaces to &lt;rsb...">rsb.F90</a>&gt; and &lt;<a class="el" href="rsb__blas__sparse_8F90.html" title="Implementation of the Fortran Sparse BLAS interface to librsb (see The Sparse BLAS interface to librs...">rsb_blas_sparse.F90</a>&gt;). </p>
<p>The following fully working example programs illustrate correct ways of using the library.</p>
<ul>
<li>First example in C, using &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;: <a class="el" href="group__rsb__doc__examples.html#examples_hello_c">examples_hello_c</a>.</li>
<li>First example in C, using &lt;<a class="el" href="blas__sparse_8h.html" title="This file specifies the Sparse BLAS interface to librsb. Supported types :(float,double,float complex,double complex) . Unsupported types:() . Level 1 ops :(dot,axpy,ga,gz,sc) . Level 2 ops :(mv,sv) . Level 3 ops :(mm,sm) . ">blas_sparse.h</a>&gt;: <a class="el" href="group__rsb__doc__examples.html#examples_hello_spblas_c">examples_hello_spblas_c</a>.</li>
<li>Autotuning example in C, using &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;: <a class="el" href="group__rsb__doc__examples.html#examples_autotune_c">examples_autotune_c</a>.</li>
<li>I/O example in C, using &lt;<a class="el" href="blas__sparse_8h.html" title="This file specifies the Sparse BLAS interface to librsb. Supported types :(float,double,float complex,double complex) . Unsupported types:() . Level 1 ops :(dot,axpy,ga,gz,sc) . Level 2 ops :(mv,sv) . Level 3 ops :(mm,sm) . ">blas_sparse.h</a>&gt;: <a class="el" href="group__rsb__doc__examples.html#examples_io_spblas_c">examples_io_spblas_c</a>.</li>
<li>Example transposing a matrix in C, using &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt; in C: <a class="el" href="group__rsb__doc__examples.html#examples_transpose_c">examples_transpose_c</a>.</li>
<li>Example showing the power method in C, using &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt; in C: <a class="el" href="group__rsb__doc__examples.html#examples_power_c">examples_power_c</a>.</li>
<li>Example in Fortran, using &lt;<a class="el" href="rsb__blas__sparse_8F90.html" title="Implementation of the Fortran Sparse BLAS interface to librsb (see The Sparse BLAS interface to librs...">rsb_blas_sparse.F90</a>&gt;: <a class="el" href="group__rsb__doc__examples.html#examples_fortran_F90">examples_fortran_F90</a>.</li>
<li>Example in Fortran, using &lt;<a class="el" href="rsb_8F90.html" title="Header file automatically generated from &lt;rsb.h&gt;, offering ISO-C-BINDING interfaces to &lt;rsb...">rsb.F90</a>&gt;: <a class="el" href="group__rsb__doc__examples.html#examples_fortran_rsb_fi_F90">examples_fortran_rsb_fi_F90</a>.</li>
<li>Example in C, using &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;: <a class="el" href="group__rsb__doc__examples.html#examples_backsolve_c">examples_backsolve_c</a>.</li>
<li>Misc example snippets in C, using &lt;<a class="el" href="rsb_8h.html" title="This file declares the user interface functions and data structures for the librsb library (see The l...">rsb.h</a>&gt;: <a class="el" href="group__rsb__doc__examples.html#examples_snippets_c">examples_snippets_c</a>.</li>
<li>Benchmark invocation from shell script: <a class="el" href="group__rsb__doc__examples.html#examples_bench_sh">examples_bench_sh</a>.</li>
</ul>
<p>Once installed <code>librsb</code>, the script displayed here (examples/make.sh) should be sufficient to build these examples: </p><div class="fragment"><div class="line">#!/bin/bash</div><div class="line"># Example script to build the librsb example programs.</div><div class="line"># Uses librsb-config in the $PATH for build flags.</div><div class="line"># Environment-provided $LIBRSB_CONFIG override that.</div><div class="line">set -e</div><div class="line">set -x</div><div class="line"></div><div class="line">srcdir=${srcdir:-`pwd`}</div><div class="line">builddir=${builddir:-`pwd`}</div><div class="line">prefix=&quot;/home/dez/src/librsb-1.3-O0/local/librsb-debug&quot;</div><div class="line">exec_prefix=&quot;${prefix}&quot;</div><div class="line">bindir=&quot;${exec_prefix}/bin&quot;</div><div class="line">if test -z &quot;${LIBRSB_CONFIG}&quot;; then</div><div class="line">        export PATH=&quot;${bindir}:$PATH&quot;</div><div class="line">fi</div><div class="line">LIBRSB_CONFIG=${LIBRSB_CONFIG:-librsb-config}</div><div class="line">PKG_CONFIG=pkg-config</div><div class="line">WANT_PKGCONFIG=&quot;no&quot;</div><div class="line">WANT_CLEANUP=${WANT_CLEANUP:-false}</div><div class="line"></div><div class="line">if test x&quot;yes&quot; == x&quot;yes&quot; ; then</div><div class="line">CXX=&quot;`${LIBRSB_CONFIG} --cxx`&quot;</div><div class="line">if test x&quot;rsblib&quot; != x&quot;&quot; -a x&quot;${CXX}&quot; != x&quot;&quot; ; then</div><div class="line">for s in ${srcdir}/*.cpp</div><div class="line">do</div><div class="line">        p=${builddir}/`basename ${s/.cpp/}`</div><div class="line">        rm -f $p</div><div class="line">        CXXFLAGS=`${LIBRSB_CONFIG} --cxxflags --I_opts`</div><div class="line">        LDFLAGS=`${LIBRSB_CONFIG} --ldflags --extra_libs`</div><div class="line">        LINK=`${LIBRSB_CONFIG} --link`</div><div class="line">        o=&quot;${p}.o&quot;</div><div class="line">        ccmd=&quot;$CXX $CXXFLAGS -c $s -o $o&quot;</div><div class="line">        lcmd=&quot;$LINK $o $LDFLAGS -o $p&quot;</div><div class="line">        echo &quot;$ccmd &amp;&amp; $lcmd&quot;</div><div class="line">        ( $ccmd &amp;&amp; $lcmd )</div><div class="line">        ${WANT_CLEANUP} &amp;&amp; rm -f &quot;$p&quot;</div><div class="line">        # one may use a single command, but that&#39;s error-prone (may miss libraries):</div><div class="line">        #cmd=&quot;$CXX $CXXFLAGS $s $LDFLAGS -o $p&quot;</div><div class="line">        #echo $cmd</div><div class="line">        #$cmd</div><div class="line">done</div><div class="line">fi</div><div class="line">fi</div><div class="line"></div><div class="line">if test x&quot;yes&quot; == x&quot;yes&quot; ; then</div><div class="line">for s in ${srcdir}/*.c</div><div class="line">do</div><div class="line">        p=`basename ${s/.c/}`</div><div class="line">        if test $p == hello-spblas -a x&quot;yes&quot; != x&quot;yes&quot; ; then continue; fi</div><div class="line">        if test $p ==    io-spblas -a x&quot;yes&quot; != x&quot;yes&quot; ; then continue; fi</div><div class="line">        rm -f $p </div><div class="line">        CFLAGS=`${LIBRSB_CONFIG} --I_opts --cppflags`</div><div class="line">        LDFLAGS=`${LIBRSB_CONFIG} --ldflags --extra_libs`</div><div class="line">        CC=`${LIBRSB_CONFIG} --cc`</div><div class="line">        LINK=`${LIBRSB_CONFIG} --link`</div><div class="line">        o=&quot;${p}.o&quot;</div><div class="line">        ccmd=&quot;$CC $CFLAGS -c $s -o $o&quot;</div><div class="line">        lcmd=&quot;$LINK $o $LDFLAGS -o $p&quot;</div><div class="line">        echo &quot;$ccmd &amp;&amp; $lcmd&quot;</div><div class="line">        ( $ccmd &amp;&amp; $lcmd )</div><div class="line">        ${WANT_CLEANUP} &amp;&amp; rm -f &quot;$p&quot;</div><div class="line">        # one may use a single command, but that&#39;s error-prone (may miss libraries):</div><div class="line">        #cmd=&quot;$CC $CFLAGS $s $LDFLAGS -o $p&quot;</div><div class="line">        #echo $cmd</div><div class="line">        #$cmd</div><div class="line">        if test x&quot;${WANT_PKGCONFIG}&quot; != x&quot;no&quot; ; then</div><div class="line">                CFLAGS=`${PKG_CONFIG} --cflags librsb`</div><div class="line">                LIBS=`${PKG_CONFIG} --libs --static librsb`</div><div class="line">                ccmd=&quot;$CC $CFLAGS -c $s -o $o&quot;</div><div class="line">                lcmd=&quot;$LINK $o $LIBS -o $p&quot;</div><div class="line">                ${WANT_CLEANUP} &amp;&amp; rm -f &quot;$p&quot;</div><div class="line">                echo &quot;$ccmd &amp;&amp; $lcmd&quot;</div><div class="line">                ( $ccmd &amp;&amp; $lcmd )</div><div class="line">        fi</div><div class="line">done</div><div class="line">fi</div><div class="line"></div><div class="line">if test x&quot;yes&quot; == x&quot;yes&quot; ; then</div><div class="line">if test x&quot;yes&quot; = x&quot;yes&quot; ; then</div><div class="line">FP=${srcdir}/fortran_rsb_fi.F90</div><div class="line">if test x&quot;yes&quot; = x&quot;yes&quot; ; then</div><div class="line">        FP+=\ ${srcdir}/fortran.F90</div><div class="line">fi</div><div class="line"># activated if you have built the Fortran modules and installed them in the right path.</div><div class="line">for s in $FP</div><div class="line">do</div><div class="line">        p=`basename ${s/.F90/}`</div><div class="line">        rm -f $p </div><div class="line">        FCFLAGS=`${LIBRSB_CONFIG} --I_opts --fcflags`</div><div class="line">        LDFLAGS=`${LIBRSB_CONFIG} --ldflags --extra_libs`</div><div class="line">        FC=`${LIBRSB_CONFIG} --fc`</div><div class="line">        LINK=`${LIBRSB_CONFIG} --link`</div><div class="line">        o=&quot;${p}.o&quot;</div><div class="line">        FCLIBS=`${LIBRSB_CONFIG} --fclibs`</div><div class="line">        ccmd=&quot;$FC $FCFLAGS -c $s -o $o&quot;</div><div class="line">        lcmd=&quot;$LINK $o $LDFLAGS $FCLIBS -o $p&quot;</div><div class="line">        echo &quot;$ccmd &amp;&amp; $lcmd&quot;</div><div class="line">        ( $ccmd &amp;&amp; $lcmd )</div><div class="line">        ${WANT_CLEANUP} &amp;&amp; rm -f &quot;$p&quot;</div><div class="line">done</div><div class="line">fi</div><div class="line">fi</div><div class="line"></div><div class="line">echo &quot; [*] done building examples!&quot;</div></div><!-- fragment --><p><a class="anchor" id="examples_hello_c"></a> <a class="el" href="hello_8c.html" title="A first &quot;hello RSB&quot; example C program based on &lt;rsb.h&gt;. Uses rsb_lib_set_opt(), rsb_mtx_get_info_str(...">examples/hello.c</a>: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Copyright (C) 2008-2021 Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">This file is part of librsb.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">(at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span><span class="comment"></span></div><div class="line"><span class="comment">/*!</span></div><div class="line"><span class="comment"> \ingroup rsb_doc_examples</span></div><div class="line"><span class="comment"> @file</span></div><div class="line"><span class="comment"> @author Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> @brief A first &quot;hello RSB&quot; example C program based on &lt;rsb.h&gt;.</span></div><div class="line"><span class="comment">   Uses #rsb_lib_set_opt(), #rsb_mtx_get_info_str().</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> \include hello.c</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rsb_8h.html">rsb.h</a>&gt;</span>        <span class="comment">/* librsb header to include */</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span>      <span class="comment">/* printf() */</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * <span class="keyword">const</span> argv[])</div><div class="line">{<span class="comment"></span></div><div class="line"><span class="comment">        /*!</span></div><div class="line"><span class="comment">          A Hello-RSB program.</span></div><div class="line"><span class="comment">         </span></div><div class="line"><span class="comment">          This program shows how to use the rsb.h interface correctly to:</span></div><div class="line"><span class="comment">         </span></div><div class="line"><span class="comment">          - initialize the library using #rsb_lib_init()</span></div><div class="line"><span class="comment">          - set library options using #rsb_lib_set_opt()</span></div><div class="line"><span class="comment">          - revert such changes </span></div><div class="line"><span class="comment">          - allocate (build) a single sparse matrix in the RSB format</span></div><div class="line"><span class="comment">            using #rsb_mtx_alloc_from_coo_const()</span></div><div class="line"><span class="comment">          - prints information obtained via #rsb_mtx_get_info_str()</span></div><div class="line"><span class="comment">          - multiply the matrix times a vector using #rsb_spmv()</span></div><div class="line"><span class="comment">          - deallocate the matrix using #rsb_mtx_free() </span></div><div class="line"><span class="comment">          - finalize the library using #rsb_lib_exit()</span></div><div class="line"><span class="comment">         </span></div><div class="line"><span class="comment">          In this example, we use #RSB_DEFAULT_TYPE as matrix type.</span></div><div class="line"><span class="comment">          This type depends on what was configured at library build time.</span></div><div class="line"><span class="comment">         * */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#ac6a4411e32793f5c150c6ab3c6f7e14e">rsb_blk_idx_t</a> bs = <a class="code" href="rsb_8h.html#a3579d00f3b97cd569707f7c62e462322">RSB_DEFAULT_BLOCKING</a>;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#ac6a4411e32793f5c150c6ab3c6f7e14e">rsb_blk_idx_t</a> brA = bs, bcA = bs;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> one = 1;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#ac0f6a03345c8874f6e50f0ed033d984b">rsb_type_t</a> typecode = <a class="code" href="rsb__types_8h.html#a56fc5ef14266266227797621e0a1e217">RSB_NUMERICAL_TYPE_DEFAULT</a>;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a46b3366e54a5b4dda754a6ace22264df">rsb_nnz_idx_t</a> nnzA = 4;           <span class="comment">/* matrix nonzeroes count */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> nrA = 3;            <span class="comment">/* matrix rows count */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> ncA = 3;            <span class="comment">/* matrix columns count */</span></div><div class="line">        <span class="comment">/* nonzero row indices coordinates: */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> IA[] = {0,1,2,2};</div><div class="line">        <span class="comment">/* nonzero column indices coordinates: */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> JA[] = {0,1,2,2};</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> VA[] = {11,22,32,1};<span class="comment">/* values of nonzeroes */</span></div><div class="line">        <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> X[] = { 0, 0, 0 };     <span class="comment">/* X vector&#39;s array */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> B[] = { -1, -2, -5 }; <span class="comment">/* B vector&#39;s array */</span></div><div class="line">        <span class="keywordtype">char</span> ib[200];</div><div class="line">        <span class="keyword">struct </span>rsb_mtx_t *mtxAp = NULL; <span class="comment">/* matrix structure pointer */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a640e84bcc5268cd92d5d31fd6ac321b8">rsb_err_t</a> errval = <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>;</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Hello, RSB!\n&quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;Initializing the library...\n&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>((errval = <a class="code" href="group__rsb__doc__rsb.html#gaf2b874d9f117ee6a6899634472b17946">rsb_lib_init</a>(<a class="code" href="rsb_8h.html#add105c42e570c5c269680d437f8c51e2">RSB_NULL_INIT_OPTIONS</a>)) != </div><div class="line">                        <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error initializing the library!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly initialized the library.\n&quot;</span>);</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Attempting to set the&quot;</span></div><div class="line">               <span class="stringliteral">&quot; RSB_IO_WANT_EXTRA_VERBOSE_INTERFACE library option.\n&quot;</span>);</div><div class="line">        {</div><div class="line">                <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> evi=1; </div><div class="line"></div><div class="line">                <span class="comment">/* Setting a single optional library parameter. */</span></div><div class="line">                errval = <a class="code" href="group__rsb__doc__rsb.html#ga2a08c5a23f3999fe8cf36440680e4a05">rsb_lib_set_opt</a>(</div><div class="line">                        <a class="code" href="group__rsb__doc__rsb.html#ggae0bada88731b01751401847d60110fb6a56c0c6849135ce5fa9edd7907ab3e0cb">RSB_IO_WANT_EXTRA_VERBOSE_INTERFACE</a>, &amp;evi);</div><div class="line">                <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">                {</div><div class="line">                        <span class="keywordtype">char</span> errbuf[256];</div><div class="line">                        <a class="code" href="group__rsb__doc__rsb.html#ga28710b8dade48738ea8e075aa1a3d262">rsb_strerror_r</a>(errval,&amp;errbuf[0],<span class="keyword">sizeof</span>(errbuf));</div><div class="line">                        printf(<span class="stringliteral">&quot;Failed setting the&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; RSB_IO_WANT_EXTRA_VERBOSE_INTERFACE&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; library option (reason string:\n%s).\n&quot;</span>,errbuf);</div><div class="line">                        <span class="keywordflow">if</span>(errval&amp;<a class="code" href="rsb_8h.html#a4d8eb05488b681b75449f64c418b8893">RSB_ERRS_UNSUPPORTED_FEATURES</a>)</div><div class="line">                        {</div><div class="line">                          printf(<span class="stringliteral">&quot;This error may be safely ignored.\n&quot;</span>);</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">else</span></div><div class="line">                        {</div><div class="line">                          printf(<span class="stringliteral">&quot;Some unexpected error occurred!\n&quot;</span>);</div><div class="line">                          <span class="keywordflow">goto</span> err;</div><div class="line">                        }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        printf(<span class="stringliteral">&quot;Setting back the &quot;</span></div><div class="line">                                <span class="stringliteral">&quot;RSB_IO_WANT_EXTRA_VERBOSE_INTERFACE&quot;</span></div><div class="line">                                <span class="stringliteral">&quot; library option.\n&quot;</span>);</div><div class="line">                        evi = 0;</div><div class="line">                        errval = <a class="code" href="group__rsb__doc__rsb.html#ga2a08c5a23f3999fe8cf36440680e4a05">rsb_lib_set_opt</a>(<a class="code" href="group__rsb__doc__rsb.html#ggae0bada88731b01751401847d60110fb6a56c0c6849135ce5fa9edd7907ab3e0cb">RSB_IO_WANT_EXTRA_VERBOSE_INTERFACE</a>,</div><div class="line">                                        &amp;evi);</div><div class="line">                        errval = <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>;</div><div class="line">                }</div><div class="line">        }</div><div class="line"></div><div class="line">        mtxAp = <a class="code" href="group__rsb__doc__rsb.html#ga86c1b0d0586f817ee31ca1caa3fee9be">rsb_mtx_alloc_from_coo_const</a>(</div><div class="line">                VA,IA,JA,nnzA,typecode,nrA,ncA,brA,bcA,</div><div class="line">                <a class="code" href="rsb_8h.html#a0ea7640214ee34c87e483c475b15827d">RSB_FLAG_NOFLAGS</a>    <span class="comment">/* default format will be chosen */</span></div><div class="line">                |<a class="code" href="rsb_8h.html#afd1b39c625f4249cd32fccea38957f97">RSB_FLAG_DUPLICATES_SUM</a><span class="comment">/* duplicates will be summed */</span></div><div class="line">                        ,&amp;errval);</div><div class="line">        <span class="keywordflow">if</span>((!mtxAp) || (errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>))</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error while allocating the matrix!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly allocated a matrix.\n&quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;Summary information of the matrix:\n&quot;</span>);</div><div class="line">        <span class="comment">/* print out the matrix summary information  */</span></div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#ga2b7d51b9822f73d2fe7fcf5b9d0be1e9">rsb_mtx_get_info_str</a>(mtxAp,<span class="stringliteral">&quot;RSB_MIF_MATRIX_INFO__TO__CHAR_P&quot;</span>,</div><div class="line">                        ib,<span class="keyword">sizeof</span>(ib));</div><div class="line">        printf(<span class="stringliteral">&quot;%s&quot;</span>,ib);</div><div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>((errval = </div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#ga4a16a82d289c76a437915db449553d4d">rsb_spmv</a>(<a class="code" href="rsb__types_8h.html#a9673f34330af77b1c0fd4a585e0c62cc">RSB_TRANSPOSITION_N</a>,&amp;one,mtxAp,B,1,&amp;one,X,1))</div><div class="line">                        != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error performing a multiplication!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly performed a SPMV.\n&quot;</span>);</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab64a020286a8b58d23d84d4512bd9132">rsb_mtx_free</a>(mtxAp);</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly freed the matrix.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>((errval = <a class="code" href="group__rsb__doc__rsb.html#ga86db30487afe975ed18a7aa6ee0db81d">rsb_lib_exit</a>(<a class="code" href="rsb_8h.html#a2234a5e51156de6c95c3f8c2951ae09f">RSB_NULL_EXIT_OPTIONS</a>))</div><div class="line">                        != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error finalizing the library!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly finalized the library.\n&quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;Program terminating with no error.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">err:</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab660cf8aff876ae88b59c7a22ddfc912">rsb_perror</a>(NULL,errval);</div><div class="line">        printf(<span class="stringliteral">&quot;Program terminating with error.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line">}</div><div class="line"></div></div><!-- fragment --><p><a class="anchor" id="examples_hello_spblas_c"></a> <a class="el" href="hello-spblas_8c.html" title="A first C &quot;hello RSB&quot; example program using a Sparse BLAS interface and &lt;rsb.h&gt;. Uses BLAS_duscr_begi...">examples/hello-spblas.c</a>: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Copyright (C) 2008-2021 Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">This file is part of librsb.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">(at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span><span class="comment"></span></div><div class="line"><span class="comment">/*!</span></div><div class="line"><span class="comment"> \ingroup rsb_doc_examples</span></div><div class="line"><span class="comment"> @file</span></div><div class="line"><span class="comment"> @author Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> @brief A first C &quot;hello RSB&quot; example program using</span></div><div class="line"><span class="comment">        a Sparse BLAS interface and &lt;rsb.h&gt;.</span></div><div class="line"><span class="comment">        Uses #BLAS_duscr_begin(), #BLAS_ussp(), #BLAS_usgp(),</span></div><div class="line"><span class="comment">        #BLAS_duscr_insert_entries(), #BLAS_duscr_end(),</span></div><div class="line"><span class="comment">        #BLAS_dusget_element(),#BLAS_dusmv(),#BLAS_usds().</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> \include hello-spblas.c</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rsb_8h.html">rsb.h</a>&gt;</span>        <span class="comment">/* for rsb_lib_init */</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="blas__sparse_8h.html">blas_sparse.h</a>&gt;</span>        <span class="comment">/* Sparse BLAS on the top of librsb */</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span>      <span class="comment">/* printf */</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * <span class="keyword">const</span> argv[])</div><div class="line">{<span class="comment"></span></div><div class="line"><span class="comment">        /*!</span></div><div class="line"><span class="comment">         * A Hello/Sparse BLAS program.</span></div><div class="line"><span class="comment">         *</span></div><div class="line"><span class="comment">         * This program shows how to use the blas_sparse.h</span></div><div class="line"><span class="comment">         * interface correctly to:</span></div><div class="line"><span class="comment">         *</span></div><div class="line"><span class="comment">         * - initialize the library using #rsb_lib_init()</span></div><div class="line"><span class="comment">         * - allocate (build) a single sparse matrix in the RSB</span></div><div class="line"><span class="comment">         *   format using #BLAS_duscr_begin()/#BLAS_duscr_insert_entries()</span></div><div class="line"><span class="comment">         *   /#BLAS_duscr_end()</span></div><div class="line"><span class="comment">         * - extract one matrix element with #BLAS_dusget_element()</span></div><div class="line"><span class="comment">         * - multiply the matrix times a vector using #BLAS_dusmv()</span></div><div class="line"><span class="comment">         * - deallocate the matrix using #BLAS_usds() </span></div><div class="line"><span class="comment">         * - finalize the library using</span></div><div class="line"><span class="comment">         *   #rsb_lib_exit(#RSB_NULL_EXIT_OPTIONS) </span></div><div class="line"><span class="comment">        */</span></div><div class="line"><span class="preprocessor">#ifndef RSB_NUMERICAL_TYPE_DOUBLE   </span></div><div class="line">        printf(<span class="stringliteral">&quot;&#39;double&#39; type configured out.&quot;</span></div><div class="line">        <span class="stringliteral">&quot; Please reconfigure the library with it and recompile.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line"><span class="preprocessor">#else </span><span class="comment">/* RSB_NUMERICAL_TYPE_DOUBLE */</span><span class="preprocessor"></span></div><div class="line">        <a class="code" href="blas__sparse_8h.html#a6f56456b01e0cc6b25b81201aa67c163">blas_sparse_matrix</a> A = <a class="code" href="blas__sparse_8h.html#a7cb10fb1b47b79ef278d6f09d571bd06a51022d3d696b9aee38d51040a5b01da7">blas_invalid_handle</a>; <span class="comment">/* handle for A */</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> nnz = 4;      <span class="comment">/* number of nonzeroes of matrix A */</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span>  nr = 3;      <span class="comment">/* number of A&#39;s rows */</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span>  nc = 3;      <span class="comment">/* number of A&#39;s columns */</span></div><div class="line">        <span class="comment">/* A&#39;s nonzero elements row indices (coordinates): */</span></div><div class="line"><span class="preprocessor">#ifdef RSB_WANT_LONG_IDX_TYPE </span></div><div class="line">        <span class="keyword">const</span> int64_t IA[] = { 0, 1, 2, 2 };</div><div class="line"><span class="preprocessor">#else </span><span class="comment">/* RSB_WANT_LONG_IDX_TYPE */</span><span class="preprocessor"></span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span>   IA[] = { 0, 1, 2, 2 };</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* RSB_WANT_LONG_IDX_TYPE */</span><span class="preprocessor"></span></div><div class="line">        <span class="comment">/* A&#39;s nonzero elements column indices (coordinates): */</span></div><div class="line"><span class="preprocessor">#ifdef RSB_WANT_LONG_IDX_TYPE </span></div><div class="line">        <span class="keyword">const</span> int64_t JA[] = { 0, 1, 0, 2 };</div><div class="line"><span class="preprocessor">#else </span><span class="comment">/* RSB_WANT_LONG_IDX_TYPE */</span><span class="preprocessor"></span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span>   JA[] = { 0, 1, 0, 2 };</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* RSB_WANT_LONG_IDX_TYPE */</span><span class="preprocessor"></span></div><div class="line">        <span class="comment">/* A&#39;s nonzero values (matrix coefficients): */</span></div><div class="line">        <span class="keywordtype">double</span> VA[] = { 11.0, 22.0, 13.0, 33.0  };</div><div class="line">        <span class="comment">/* the X vector&#39;s array: */</span></div><div class="line">        <span class="keywordtype">double</span> X[] = { 0.0, 0.0, 0.0 };</div><div class="line">        <span class="comment">/* the B vector&#39;s array: */</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> B[] = { -1.0, -2.0, -2.0 };</div><div class="line">        <span class="comment">/* the (known) result array: */</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> AB[] = { 11.0+26.0, 44.0, 66.0+13.0 };</div><div class="line">        <span class="comment">/* rsb error variable: */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a640e84bcc5268cd92d5d31fd6ac321b8">rsb_err_t</a> errval = <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>;</div><div class="line">        <span class="keywordtype">int</span> i;</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Hello, RSB!\n&quot;</span>);</div><div class="line">        <span class="comment">/* initialize the library */</span></div><div class="line">        <span class="keywordflow">if</span>((errval = <a class="code" href="group__rsb__doc__rsb.html#gaf2b874d9f117ee6a6899634472b17946">rsb_lib_init</a>(<a class="code" href="rsb_8h.html#add105c42e570c5c269680d437f8c51e2">RSB_NULL_INIT_OPTIONS</a>)) </div><div class="line">                        != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly initialized the library.\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">/* initialize a matrix descriptor */</span></div><div class="line">        A = <a class="code" href="group__rsb__doc__sparse__blas.html#gac931dcb1129ee3016ab82602c3d14fee">BLAS_duscr_begin</a>(nr,nc);</div><div class="line">        <span class="keywordflow">if</span>( A == <a class="code" href="blas__sparse_8h.html#a7cb10fb1b47b79ef278d6f09d571bd06a51022d3d696b9aee38d51040a5b01da7">blas_invalid_handle</a> )</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="comment">/* specify properties (e.g.: symmetry)*/</span></div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="blas__sparse_8h.html#a6719ae77dfef6d6dd0790e34a65c1924">BLAS_ussp</a>(A,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63baba96b7c19a0ccfe3be9d78cb27690487">blas_lower_symmetric</a>) != 0 )</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* get properties (e.g.: symmetry) */</span></div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="blas__sparse_8h.html#a5eec91b6d95962811bd9cb4e37266214">BLAS_usgp</a>(A,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63baba96b7c19a0ccfe3be9d78cb27690487">blas_lower_symmetric</a>) != 1 )</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Symmetry property non set ?!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* insert the nonzeroes (here, all at once) */</span></div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="group__rsb__doc__sparse__blas.html#gae0683bc8f0af5dd3e53b964190f9e1b4">BLAS_duscr_insert_entries</a>(A, nnz, VA, IA, JA)</div><div class="line">                        == <a class="code" href="blas__sparse_8h.html#a7cb10fb1b47b79ef278d6f09d571bd06a51022d3d696b9aee38d51040a5b01da7">blas_invalid_handle</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* finalize (allocate) the matrix build  */</span></div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="group__rsb__doc__sparse__blas.html#ga5d9ce97bf054b1e3750eaae5d4e6c335">BLAS_duscr_end</a>(A) == <a class="code" href="blas__sparse_8h.html#a7cb10fb1b47b79ef278d6f09d571bd06a51022d3d696b9aee38d51040a5b01da7">blas_invalid_handle</a> )</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly allocated a matrix.\n&quot;</span>);</div><div class="line"></div><div class="line">        VA[0] = 0.0;</div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="group__rsb__doc__sparse__blas.html#ga7cdfc09a860b29267539c4868f41ec51">BLAS_dusget_element</a>(A, IA[0], JA[0], &amp;VA[0]) )</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* a check */</span></div><div class="line">        <span class="keywordflow">if</span>( VA[0] != 11.0 )</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* compute X = X + (-1) * A * B   */</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__rsb__doc__sparse__blas.html#gad018cf218c2c938bb5cf4577f1b53319">BLAS_dusmv</a>(<a class="code" href="blas__sparse_8h.html#a23e5e138364c80074ac014a3dfd346b7a60c827bef60beeea296c26486e28d85f">blas_no_trans</a>,-1,A,B,1,X,1))</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span>( i = 0 ; i &lt; nc; ++i )</div><div class="line">                <span class="keywordflow">if</span>( X[i] != AB[i] )</div><div class="line">                {</div><div class="line">                        printf(<span class="stringliteral">&quot;Computed SPMV result seems wrong. Terminating.\n&quot;</span>);</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line">                }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly performed a SPMV.\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">/* deallocate matrix A */</span></div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="group__rsb__doc__sparse__blas.html#ga8b0cca8196f40f7b55084a978b40717f">BLAS_usds</a>(A) )</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly freed the matrix.\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">/* finalize the library */</span></div><div class="line">        <span class="keywordflow">if</span>((errval = <a class="code" href="group__rsb__doc__rsb.html#ga86db30487afe975ed18a7aa6ee0db81d">rsb_lib_exit</a>(<a class="code" href="rsb_8h.html#a2234a5e51156de6c95c3f8c2951ae09f">RSB_NULL_EXIT_OPTIONS</a>))</div><div class="line">                        != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly finalized the library.\n&quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;Program terminating with no error.\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">err:</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab660cf8aff876ae88b59c7a22ddfc912">rsb_perror</a>(NULL,errval);</div><div class="line">        printf(<span class="stringliteral">&quot;Program terminating with error.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* RSB_NUMERICAL_TYPE_DOUBLE */</span><span class="preprocessor"></span></div><div class="line">}</div><div class="line"></div></div><!-- fragment --><p><a class="anchor" id="examples_autotune_c"></a> <a class="el" href="autotune_8c.html" title="C &quot;RSB autotune&quot; example program based on &lt;rsb.h&gt;. uses rsb_file_mtx_load(), rsb_spmm(), rsb_tune_spmm(). ">examples/autotune.c</a>: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Copyright (C) 2008-2021 Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">This file is part of librsb.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">(at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span><span class="comment"></span></div><div class="line"><span class="comment">/*!</span></div><div class="line"><span class="comment"> \ingroup rsb_doc_examples</span></div><div class="line"><span class="comment"> @file</span></div><div class="line"><span class="comment"> @author Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> @brief C &quot;RSB autotune&quot; example program based on &lt;rsb.h&gt;.</span></div><div class="line"><span class="comment">   uses #rsb_file_mtx_load(), rsb_spmm(), rsb_tune_spmm().</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> \include autotune.c</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rsb_8h.html">rsb.h</a>&gt;</span>        <span class="comment">/* librsb header to include */</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span>      <span class="comment">/* printf() */</span></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span>      <span class="comment">/* isdigit() */</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span>     <span class="comment">/* atoi() */</span></div><div class="line"><span class="comment">/* #include &quot;rsb_internals.h&quot; */</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> tune_from_file(<span class="keywordtype">char</span> * <span class="keyword">const</span> filename, <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> wvat)</div><div class="line">{</div><div class="line">        <span class="keyword">struct </span>rsb_mtx_t *mtxMp = NULL;</div><div class="line">        <span class="comment">/* spmv specific variables */</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">void</span> * alphap = NULL; <span class="comment">// equivalent to 1</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">void</span> * betap = NULL; <span class="comment">// equivalent to 1</span></div><div class="line">        <a class="code" href="rsb_8h.html#a569215d6312bf658b32d3e89cf2e0715">rsb_flags_t</a> order = <a class="code" href="rsb_8h.html#a6ed7790c2f7129a6e051b8167c48a43c">RSB_FLAG_WANT_COLUMN_MAJOR_ORDER</a>;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> nrhs = 2;  <span class="comment">/* number of right hand sides */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a46095ea7e61e1d1ec0ad055cf0291901">rsb_trans_t</a> transA = <a class="code" href="rsb__types_8h.html#a9673f34330af77b1c0fd4a585e0c62cc">RSB_TRANSPOSITION_N</a>; <span class="comment">/* transposition */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a46b3366e54a5b4dda754a6ace22264df">rsb_nnz_idx_t</a> ldB = 0;</div><div class="line">        <a class="code" href="rsb_8h.html#a46b3366e54a5b4dda754a6ace22264df">rsb_nnz_idx_t</a> ldC = 0;</div><div class="line">        <span class="comment">/* misc variables */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a640e84bcc5268cd92d5d31fd6ac321b8">rsb_err_t</a> errval = <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>;</div><div class="line">        <a class="code" href="rsb_8h.html#ab7a0af874a2765e9271a63ee4acf3d5d">rsb_time_t</a> dt;</div><div class="line">        <span class="keywordtype">char</span> ib[200];</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>*is = <span class="stringliteral">&quot;RSB_MIF_MATRIX_INFO__TO__CHAR_P&quot;</span>;</div><div class="line">        <span class="comment">/* misc variables */</span></div><div class="line">        <span class="comment">/* input autotuning variables */</span></div><div class="line">        <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> oitmax = 1 <span class="comment">/*15*/</span>;    <span class="comment">/* auto-tune iterations */</span></div><div class="line">        <a class="code" href="rsb_8h.html#ab7a0af874a2765e9271a63ee4acf3d5d">rsb_time_t</a> tmax = 0.1;  <span class="comment">/* time per autotune operation */</span></div><div class="line">        <span class="comment">/* output autotuning variables */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a569215d6312bf658b32d3e89cf2e0715">rsb_flags_t</a> flagsA = <a class="code" href="rsb_8h.html#a0ea7640214ee34c87e483c475b15827d">RSB_FLAG_NOFLAGS</a>;</div><div class="line">        <span class="comment">/* int ione = 1; */</span></div><div class="line">        <a class="code" href="rsb_8h.html#ac0f6a03345c8874f6e50f0ed033d984b">rsb_type_t</a> typecodea [] = RSB_MATRIX_TYPE_CODES_ARRAY;</div><div class="line">        <span class="keywordtype">int</span> typecodei;</div><div class="line"></div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#gaf2b874d9f117ee6a6899634472b17946">rsb_lib_init</a>(<a class="code" href="rsb_8h.html#add105c42e570c5c269680d437f8c51e2">RSB_NULL_INIT_OPTIONS</a>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>( (errval) != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga2a08c5a23f3999fe8cf36440680e4a05">rsb_lib_set_opt</a>(<a class="code" href="group__rsb__doc__rsb.html#ggae0bada88731b01751401847d60110fb6a2164b61bd47cf53a3c8d287b419ab591">RSB_IO_WANT_VERBOSE_TUNING</a>, &amp;wvat );</div><div class="line">        </div><div class="line">        <span class="comment">/*</span></div><div class="line"><span class="comment">        errval = rsb_lib_set_opt(RSB_IO_WANT_EXTRA_VERBOSE_INTERFACE, &amp;ione);</span></div><div class="line"><span class="comment">        */</span></div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>( (errval) != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Loading matrix from file \&quot;%s\&quot;.\n&quot;</span>,filename);</div><div class="line"></div><div class="line">        mtxMp = <a class="code" href="group__rsb__doc__rsb.html#ga00833b0cf57da8e430f9d0e2b5375bb3">rsb_file_mtx_load</a>(filename, flagsA, typecodea[0], &amp;errval);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>( (errval) != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span>( typecodei = 0 ; typecodei &lt; RSB_IMPLEMENTED_TYPES; ++typecodei )</div><div class="line">        {</div><div class="line">                <a class="code" href="rsb_8h.html#ac0f6a03345c8874f6e50f0ed033d984b">rsb_type_t</a> typecode = typecodea[typecodei];</div><div class="line">                <span class="keyword">struct </span>rsb_mtx_t *mtxAp = NULL;</div><div class="line">                <span class="keyword">struct </span>rsb_mtx_t *mtxOp = NULL;</div><div class="line">                <a class="code" href="rsb_8h.html#ab6fedd060aee0dd9f61f0438987a99a9">rsb_real_t</a> sf = 0.0;</div><div class="line">                <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> tn = 0;</div><div class="line"></div><div class="line">                sf = 0.0;</div><div class="line">                tn = 0;</div><div class="line"></div><div class="line">                printf(<span class="stringliteral">&quot;Considering %c clone.\n&quot;</span>,typecode);</div><div class="line">                </div><div class="line">                errval = <a class="code" href="group__rsb__doc__rsb.html#gae181671ba19191caa5a282cbde4fdfc5">rsb_mtx_clone</a>(&amp;mtxAp, typecode, transA, NULL, mtxMp,</div><div class="line">                                flagsA);</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span>( (errval) != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">                printf(<span class="stringliteral">&quot;Base matrix:\n&quot;</span>);</div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#ga2b7d51b9822f73d2fe7fcf5b9d0be1e9">rsb_mtx_get_info_str</a>(mtxAp,is,ib,<span class="keyword">sizeof</span>(ib));</div><div class="line">                printf(<span class="stringliteral">&quot;%s\n\n&quot;</span>,ib);</div><div class="line"></div><div class="line">                dt = -<a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">                errval = <a class="code" href="group__rsb__doc__rsb.html#ga8c11024d248e2e686476fd9e89aa7c15">rsb_tune_spmm</a>(NULL, &amp;sf, &amp;tn, oitmax, tmax, transA,</div><div class="line">                     alphap, mtxAp, nrhs, order, NULL, ldB, betap, NULL, ldC);</div><div class="line"></div><div class="line">                dt += <a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">                <span class="keywordflow">if</span>(tn == 0)</div><div class="line">                printf(<span class="stringliteral">&quot;After %lfs, autotuning routine did not find a better&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; threads count configuration.\n&quot;</span>,dt);</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                printf(<span class="stringliteral">&quot;After %lfs, thread autotuning declared speedup of %lg x,&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; when using threads count of %d.\n&quot;</span>,dt,sf,tn);</div><div class="line">                printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">                dt = -<a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line"></div><div class="line">                mtxOp = mtxAp;</div><div class="line">                errval = <a class="code" href="group__rsb__doc__rsb.html#ga8c11024d248e2e686476fd9e89aa7c15">rsb_tune_spmm</a>(&amp;mtxAp, &amp;sf, &amp;tn, oitmax, tmax, transA,</div><div class="line">                        alphap, NULL, nrhs, order, NULL, ldB, betap, NULL, ldC);</div><div class="line">                <span class="keywordflow">if</span>( (errval) != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">                dt += <a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">                <span class="keywordflow">if</span>( mtxOp == mtxAp )</div><div class="line">                {</div><div class="line">                        printf(<span class="stringliteral">&quot;After %lfs, global autotuning found old matrix optimal,&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; with declared speedup %lg x when using %d threads\n&quot;</span>,dt,sf,tn);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        printf(<span class="stringliteral">&quot;After %lfs, global autotuning declared speedup of %lg x,&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; when using threads count of %d and a new matrix:\n&quot;</span>,dt,sf,tn);</div><div class="line">                        <a class="code" href="group__rsb__doc__rsb.html#ga2b7d51b9822f73d2fe7fcf5b9d0be1e9">rsb_mtx_get_info_str</a>(mtxAp,is,ib,<span class="keyword">sizeof</span>(ib));</div><div class="line">                        printf(<span class="stringliteral">&quot;%s\n&quot;</span>,ib);</div><div class="line">                }</div><div class="line">                printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"></div><div class="line">                <span class="comment">/* user is expected to:</span></div><div class="line"><span class="comment">                errval = rsb_lib_set_opt(RSB_IO_WANT_EXECUTING_THREADS,&amp;tn);</span></div><div class="line"><span class="comment">                and use mtxAp in SpMV.</span></div><div class="line"><span class="comment">                */</span></div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#gab64a020286a8b58d23d84d4512bd9132">rsb_mtx_free</a>(mtxAp);</div><div class="line">                mtxAp = NULL;</div><div class="line">        }</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab64a020286a8b58d23d84d4512bd9132">rsb_mtx_free</a>(mtxMp);</div><div class="line">        mtxMp = NULL;</div><div class="line"></div><div class="line">err:</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab660cf8aff876ae88b59c7a22ddfc912">rsb_perror</a>(NULL,errval);</div><div class="line">        <span class="keywordflow">if</span> ( errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">                printf(<span class="stringliteral">&quot;Program terminating with error.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> errval;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * <span class="keyword">const</span> argv[])</div><div class="line">{<span class="comment"></span></div><div class="line"><span class="comment">        /*!</span></div><div class="line"><span class="comment">         Autotuning example.</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="comment">/* matrix variables */</span></div><div class="line">        <span class="keyword">struct </span>rsb_mtx_t *mtxAp = NULL; <span class="comment">/* matrix structure pointer */</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> bs = <a class="code" href="rsb_8h.html#a3579d00f3b97cd569707f7c62e462322">RSB_DEFAULT_BLOCKING</a>;</div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> nrA = 500; <span class="comment">/* number of rows */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> ncA = 500; <span class="comment">/* number of cols */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#ac0f6a03345c8874f6e50f0ed033d984b">rsb_type_t</a> typecode = <a class="code" href="rsb__types_8h.html#a56fc5ef14266266227797621e0a1e217">RSB_NUMERICAL_TYPE_DEFAULT</a>;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> rd = 1;<span class="comment">/* every rd rows one is non empty */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> cd = 4;<span class="comment">/* every cd cols one is non empty */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a46b3366e54a5b4dda754a6ace22264df">rsb_nnz_idx_t</a> nnzA = (nrA/rd)*(ncA/cd); <span class="comment">/* nonzeroes */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>*IA = NULL;</div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>*JA = NULL;</div><div class="line">        <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a>*VA = NULL;</div><div class="line">        <span class="comment">/* spmv specific variables */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> alpha = 1;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> beta = 1;</div><div class="line">        <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a>*Cp = NULL;</div><div class="line">        <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a>*Bp = NULL;</div><div class="line">        <a class="code" href="rsb_8h.html#a569215d6312bf658b32d3e89cf2e0715">rsb_flags_t</a> order = <a class="code" href="rsb_8h.html#a6ed7790c2f7129a6e051b8167c48a43c">RSB_FLAG_WANT_COLUMN_MAJOR_ORDER</a>;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> nrhs = 2;  <span class="comment">/* number of right hand sides */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a46095ea7e61e1d1ec0ad055cf0291901">rsb_trans_t</a> transA = <a class="code" href="rsb__types_8h.html#a9673f34330af77b1c0fd4a585e0c62cc">RSB_TRANSPOSITION_N</a>;</div><div class="line">        <a class="code" href="rsb_8h.html#a46b3366e54a5b4dda754a6ace22264df">rsb_nnz_idx_t</a> ldB = nrA;</div><div class="line">        <a class="code" href="rsb_8h.html#a46b3366e54a5b4dda754a6ace22264df">rsb_nnz_idx_t</a> ldC = ncA;</div><div class="line">        <span class="comment">/* misc variables */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a640e84bcc5268cd92d5d31fd6ac321b8">rsb_err_t</a> errval = <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>;</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> so = <span class="keyword">sizeof</span>(<a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a>);</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> si = <span class="keyword">sizeof</span>(<a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>);</div><div class="line">        <a class="code" href="rsb_8h.html#ab7a0af874a2765e9271a63ee4acf3d5d">rsb_time_t</a> dt,odt;</div><div class="line">        <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> t;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> tt = 100;       <span class="comment">/* will repeat spmv tt times */</span></div><div class="line">        <span class="keywordtype">char</span> ib[200];</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>*is = <span class="stringliteral">&quot;RSB_MIF_MATRIX_INFO__TO__CHAR_P&quot;</span>;</div><div class="line">        <span class="comment">/* misc counters */</span></div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> ci;</div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> ri;</div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> ni;</div><div class="line">        <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> nrhsi;</div><div class="line">        <span class="comment">/* misc variables */</span></div><div class="line">        <a class="code" href="rsb_8h.html#ab7a0af874a2765e9271a63ee4acf3d5d">rsb_time_t</a> etime = 0.0;</div><div class="line">        <span class="comment">/* input autotuning variables */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> oitmax = 15;    <span class="comment">/* auto-tune iterations */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#ab7a0af874a2765e9271a63ee4acf3d5d">rsb_time_t</a> tmax = 0.1;    <span class="comment">/* time per autotune operation */</span></div><div class="line">        <span class="comment">/* input/output autotuning variables */</span></div><div class="line">        <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> tn = 0;       <span class="comment">/* threads number */</span></div><div class="line">        <span class="comment">/* output autotuning variables */</span></div><div class="line">        <a class="code" href="rsb_8h.html#ab6fedd060aee0dd9f61f0438987a99a9">rsb_real_t</a> sf = 0.0;    <span class="comment">/* speedup factor obtained from auto tuning */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> wvat = 1; <span class="comment">/* want verbose autotuning; see </span></div><div class="line"><span class="comment">                documentation of RSB_IO_WANT_VERBOSE_TUNING */</span></div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(argc &gt; 1 &amp;&amp; !isdigit(argv[1][0]) )</div><div class="line">        {</div><div class="line">                errval = tune_from_file(argv[1],wvat);</div><div class="line">                <span class="keywordflow">goto</span> ret;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(argc &gt; 1)</div><div class="line">        {</div><div class="line">                nrA = ncA = atoi(argv[1]);</div><div class="line">                <span class="keywordflow">if</span> ( nrA &lt; <a class="code" href="rsb_8h.html#abaccfe39f69712cebf501c9d55b1a4b8">RSB_MIN_MATRIX_DIM</a> || (nrA &gt; (<a class="code" href="rsb_8h.html#a318a92d60883f6ade7345459074374f5">RSB_MAX_MATRIX_DIM</a>) ))</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">                nnzA = (nrA/rd)*(ncA/cd);</div><div class="line">                ldB = nrA;</div><div class="line">                ldC = ncA;</div><div class="line">        }</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Creating %d x %d matrix with %d nonzeroes.\n&quot;</span>,(<span class="keywordtype">int</span>)nrA,</div><div class="line">                (<span class="keywordtype">int</span>)ncA, (<span class="keywordtype">int</span>)nnzA);</div><div class="line"></div><div class="line">        IA = calloc(nnzA, si);</div><div class="line">        JA = calloc(nnzA, si);</div><div class="line">        VA = calloc(nnzA, so);</div><div class="line">        Bp = calloc(nrhs*ncA ,so);</div><div class="line">        Cp = calloc(nrhs*nrA ,so);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>( ! ( VA &amp;&amp; IA &amp;&amp; JA &amp;&amp; Bp &amp;&amp; Cp ) )</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span>(nrhsi=0;nrhsi&lt;nrhs;++nrhsi)</div><div class="line">                <span class="keywordflow">for</span>(ci=0;ci&lt;ncA/cd;++ci)</div><div class="line">                        Bp[nrhsi*ldC+ci] = 1.0;</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span>(nrhsi=0;nrhsi&lt;nrhs;++nrhsi)</div><div class="line">                <span class="keywordflow">for</span>(ri=0;ri&lt;nrA/rd;++ri)</div><div class="line">                        Cp[nrhsi*ldC+ri] = 1.0;</div><div class="line"></div><div class="line">        ni = 0;</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span>(ci=0;ci&lt;ncA/cd;++ci)</div><div class="line">                <span class="keywordflow">for</span>(ri=0;ri&lt;nrA/rd;++ri)</div><div class="line">                {</div><div class="line">                        VA[ni] = nrA * ri + ci,</div><div class="line">                        IA[ni] = ri;</div><div class="line">                        JA[ni] = ci;</div><div class="line">                        ni++;</div><div class="line">                }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>((errval = <a class="code" href="group__rsb__doc__rsb.html#gaf2b874d9f117ee6a6899634472b17946">rsb_lib_init</a>(<a class="code" href="rsb_8h.html#add105c42e570c5c269680d437f8c51e2">RSB_NULL_INIT_OPTIONS</a>))</div><div class="line">                        != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>) <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga2a08c5a23f3999fe8cf36440680e4a05">rsb_lib_set_opt</a>(<a class="code" href="group__rsb__doc__rsb.html#ggae0bada88731b01751401847d60110fb6a2164b61bd47cf53a3c8d287b419ab591">RSB_IO_WANT_VERBOSE_TUNING</a>, &amp;wvat );</div><div class="line">        <span class="keywordflow">if</span>( (errval) != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error setting option!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        mtxAp = <a class="code" href="group__rsb__doc__rsb.html#ga86c1b0d0586f817ee31ca1caa3fee9be">rsb_mtx_alloc_from_coo_const</a>(</div><div class="line">                VA,IA,JA,nnzA,typecode,nrA,ncA,bs,bs,</div><div class="line">                <a class="code" href="rsb_8h.html#a0ea7640214ee34c87e483c475b15827d">RSB_FLAG_NOFLAGS</a>,&amp;errval);</div><div class="line"></div><div class="line">        <span class="comment">/* VA, IA, JA are not necessary anymore */</span></div><div class="line">        free(VA);</div><div class="line">        free(IA);</div><div class="line">        free(JA);</div><div class="line">        VA = NULL;</div><div class="line">        IA = NULL;</div><div class="line">        JA = NULL;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>((!mtxAp) || (errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>))</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Allocated matrix of %zd nonzeroes:\n&quot;</span>,(<span class="keywordtype">size_t</span>)nnzA);</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#ga2b7d51b9822f73d2fe7fcf5b9d0be1e9">rsb_mtx_get_info_str</a>(mtxAp,is,ib,<span class="keyword">sizeof</span>(ib));</div><div class="line">        printf(<span class="stringliteral">&quot;%s\n\n&quot;</span>,ib);</div><div class="line"></div><div class="line">        dt = - <a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">        <span class="keywordflow">for</span>(t=0;t&lt;tt;++t)</div><div class="line">                <span class="comment">/* </span></div><div class="line"><span class="comment">                   If nrhs == 1, the following is equivalent to</span></div><div class="line"><span class="comment">                   rsb_spmv(transA,alphap,mtxAp,Bp,1,betap,Cp,1);</span></div><div class="line"><span class="comment">                */</span></div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#ga3ec8d721b5333aae6ea9b03eb0039285">rsb_spmm</a>(transA,&amp;alpha,mtxAp,nrhs,order,Bp,ldB,&amp;beta,Cp,ldC);</div><div class="line">        dt += <a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">        odt = dt;</div><div class="line">        printf(<span class="stringliteral">&quot;Before auto-tuning, %d multiplications took %lfs.\n&quot;</span>,tt,dt);</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Threads autotuning (may take more than %lfs)...\n&quot;</span>,</div><div class="line">                        oitmax*tmax);</div><div class="line">        dt = -<a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga8c11024d248e2e686476fd9e89aa7c15">rsb_tune_spmm</a>(NULL, &amp;sf, &amp;tn, oitmax, tmax, transA,</div><div class="line">                        &amp;alpha, mtxAp, nrhs, order, Bp, ldB, &amp;beta, Cp, ldC);</div><div class="line">        dt += <a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">        <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(tn == 0)</div><div class="line">        printf(<span class="stringliteral">&quot;After %lfs, autotuning routine did not find a better&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; threads count configuration.\n&quot;</span>,dt);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        printf(<span class="stringliteral">&quot;After %lfs, autotuning routine declared speedup of %lg x,&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; when using threads count of %d.\n&quot;</span>,dt,sf,tn);</div><div class="line"></div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga2a08c5a23f3999fe8cf36440680e4a05">rsb_lib_set_opt</a>(<a class="code" href="group__rsb__doc__rsb.html#ggae0bada88731b01751401847d60110fb6ad9150d4d5672d1835185d6e2286d92f4">RSB_IO_WANT_EXECUTING_THREADS</a>,&amp;tn);</div><div class="line">        <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#ga2b7d51b9822f73d2fe7fcf5b9d0be1e9">rsb_mtx_get_info_str</a>(mtxAp,is,ib,<span class="keyword">sizeof</span>(ib));</div><div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>,ib);</div><div class="line"></div><div class="line">        dt = -<a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">        <span class="keywordflow">for</span>(t=0;t&lt;tt;++t)</div><div class="line">                <span class="comment">/*rsb_spmv(transA,&amp;alpha,mtxAp,Bp,1,&amp;beta,Cp,1);*/</span></div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#ga3ec8d721b5333aae6ea9b03eb0039285">rsb_spmm</a>(transA,&amp;alpha,mtxAp,nrhs,order,Bp,ldB,&amp;beta,Cp,ldC);</div><div class="line">        dt += <a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">        printf(<span class="stringliteral">&quot;After threads auto-tuning, %d multiplications took %lfs&quot;</span></div><div class="line">                        <span class="stringliteral">&quot;  --  effective speedup of %lg x\n&quot;</span>,tt,dt,odt/dt);</div><div class="line">        odt = dt;</div><div class="line"></div><div class="line"></div><div class="line">        tn = 0; <span class="comment">/* this will restore default threads count */</span></div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga2a08c5a23f3999fe8cf36440680e4a05">rsb_lib_set_opt</a>(<a class="code" href="group__rsb__doc__rsb.html#ggae0bada88731b01751401847d60110fb6ad9150d4d5672d1835185d6e2286d92f4">RSB_IO_WANT_EXECUTING_THREADS</a>,&amp;tn);</div><div class="line">        <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga96a28efc32dd050d2a74208b3ad2f227">rsb_lib_get_opt</a>(<a class="code" href="group__rsb__doc__rsb.html#ggae0bada88731b01751401847d60110fb6ad9150d4d5672d1835185d6e2286d92f4">RSB_IO_WANT_EXECUTING_THREADS</a>,&amp;tn);</div><div class="line">        <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Matrix autotuning (may take more than %lfs; using %d&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; threads )...\n&quot;</span>, oitmax*tmax, tn);</div><div class="line"></div><div class="line">        <span class="comment">/* A negative tn will request also threads autotuning: */</span></div><div class="line">        <span class="comment">/* tn = -tn; */</span></div><div class="line"></div><div class="line">        dt = -<a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga8c11024d248e2e686476fd9e89aa7c15">rsb_tune_spmm</a>(&amp;mtxAp, &amp;sf, &amp;tn, oitmax, tmax, transA,</div><div class="line">                &amp;alpha,  NULL, nrhs, order, Bp, ldB, &amp;beta, Cp, ldC);</div><div class="line">        dt += <a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(tn == 0)</div><div class="line">        printf(<span class="stringliteral">&quot;After %lfs, autotuning routine did not find a better&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; threads count configuration.\n&quot;</span>,dt);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        printf(<span class="stringliteral">&quot;After %lfs, autotuning routine declared speedup of %lg x,&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; when using threads count of %d.\n&quot;</span>,dt,sf,tn);</div><div class="line"></div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#ga2b7d51b9822f73d2fe7fcf5b9d0be1e9">rsb_mtx_get_info_str</a>(mtxAp,is,ib,<span class="keyword">sizeof</span>(ib));</div><div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>,ib);</div><div class="line"></div><div class="line">        dt = -<a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">        <span class="keywordflow">for</span>(t=0;t&lt;tt;++t)</div><div class="line">                <span class="comment">/*rsb_spmv(transA,&amp;alpha,mtxAp,Bp,1,&amp;beta,Cp,1);*/</span></div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#ga3ec8d721b5333aae6ea9b03eb0039285">rsb_spmm</a>(transA,&amp;alpha,mtxAp,nrhs,order,Bp,ldB,&amp;beta,Cp,ldC);</div><div class="line">        dt += <a class="code" href="group__rsb__doc__rsb.html#ga6677d4e20c00bdf4ebf53567246f5693">rsb_time</a>();</div><div class="line">        printf(<span class="stringliteral">&quot;After threads auto-tuning, %d multiplications took %lfs&quot;</span></div><div class="line">                        <span class="stringliteral">&quot;  --  further speedup of %lg x\n&quot;</span>,tt,dt,odt/dt);</div><div class="line"></div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab64a020286a8b58d23d84d4512bd9132">rsb_mtx_free</a>(mtxAp);</div><div class="line">        free(Cp);</div><div class="line">        free(Bp);</div><div class="line"></div><div class="line"></div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga96a28efc32dd050d2a74208b3ad2f227">rsb_lib_get_opt</a>(<a class="code" href="group__rsb__doc__rsb.html#ggae0bada88731b01751401847d60110fb6ae900da85e3fc1f46083ee0abf34db1d9">RSB_IO_WANT_LIBRSB_ETIME</a>,&amp;etime);</div><div class="line">        <span class="keywordflow">if</span>(errval == <a class="code" href="rsb_8h.html#accf836c8eb3145e9ab4fd277d6911764">RSB_ERR_UNSUPPORTED_FEATURE</a>)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;librsb timer-based profiling is not supported in &quot;</span></div><div class="line">                <span class="stringliteral">&quot;this build. If you wish to have it, re-configure librsb &quot;</span></div><div class="line">                <span class="stringliteral">&quot;with its support. So you can safely ignore the error you&quot;</span></div><div class="line">                <span class="stringliteral">&quot; might just have seen printed out on screen.\n&quot;</span>);</div><div class="line">                errval = <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        <span class="keywordflow">if</span>(etime) <span class="comment">/* This will only work if enabled at configure time. */</span></div><div class="line">                printf(<span class="stringliteral">&quot;Elapsed program time is %5.2lfs\n&quot;</span>,etime);</div><div class="line"></div><div class="line">ret:</div><div class="line">        <span class="keywordflow">if</span>((errval = <a class="code" href="group__rsb__doc__rsb.html#ga86db30487afe975ed18a7aa6ee0db81d">rsb_lib_exit</a>(<a class="code" href="rsb_8h.html#a2234a5e51156de6c95c3f8c2951ae09f">RSB_NULL_EXIT_OPTIONS</a>))</div><div class="line">                        !=<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">err:</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab660cf8aff876ae88b59c7a22ddfc912">rsb_perror</a>(NULL,errval);</div><div class="line">        printf(<span class="stringliteral">&quot;Program terminating with error.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line">}</div></div><!-- fragment --><p><a class="anchor" id="examples_io_spblas_c"></a> <a class="el" href="io-spblas_8c.html" title="Example C program using the Sparse BLAS interface and reading from file using rsb_blas_file_mtx_load(...">examples/io-spblas.c</a>: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Copyright (C) 2008-2021 Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">This file is part of librsb.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">(at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span><span class="comment"></span></div><div class="line"><span class="comment">/*!</span></div><div class="line"><span class="comment"> \ingroup rsb_doc_examples</span></div><div class="line"><span class="comment"> @file</span></div><div class="line"><span class="comment"> @author Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> @brief Example C program using the Sparse BLAS interface</span></div><div class="line"><span class="comment">        and reading from file using \ref rsb_blas_file_mtx_load(),</span></div><div class="line"><span class="comment">        \ref BLAS_usgp(), \ref BLAS_dusmv(), \ref BLAS_usds().</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> \include io-spblas.c</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rsb_8h.html">rsb.h</a>&gt;</span>        <span class="comment">/* for rsb_lib_init */</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="blas__sparse_8h.html">blas_sparse.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line">        </div><div class="line"><span class="keywordtype">int</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * <span class="keyword">const</span> argv[])</div><div class="line">{</div><div class="line"><span class="preprocessor">#ifndef RSB_NUMERICAL_TYPE_DOUBLE   </span></div><div class="line">        printf(<span class="stringliteral">&quot;Skipping a test because of &#39;double&#39; type opted out.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line"><span class="preprocessor">#else </span><span class="comment">/* RSB_NUMERICAL_TYPE_DOUBLE */</span><span class="preprocessor"></span></div><div class="line">        <a class="code" href="blas__sparse_8h.html#a6f56456b01e0cc6b25b81201aa67c163">blas_sparse_matrix</a> A = <a class="code" href="blas__sparse_8h.html#a7cb10fb1b47b79ef278d6f09d571bd06a51022d3d696b9aee38d51040a5b01da7">blas_invalid_handle</a>;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#ac0f6a03345c8874f6e50f0ed033d984b">rsb_type_t</a> typecode = <a class="code" href="rsb__types_8h.html#a7849bc51eadedaa51a1b27569be89d86">RSB_NUMERICAL_TYPE_DOUBLE</a>;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a10ec0af478bcccdab11545b106678ef6">rsb_char_t</a> * filename = argc &gt; 1 ? argv[1] : <span class="stringliteral">&quot;pd.mtx&quot;</span>;</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Hello, RSB!\n&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>((<a class="code" href="group__rsb__doc__rsb.html#gab660cf8aff876ae88b59c7a22ddfc912">rsb_perror</a>(NULL,</div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#gaf2b874d9f117ee6a6899634472b17946">rsb_lib_init</a>(<a class="code" href="rsb_8h.html#add105c42e570c5c269680d437f8c51e2">RSB_NULL_INIT_OPTIONS</a>)))!=<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error while initializing the library.\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Correctly initialized the library.\n&quot;</span>);</div><div class="line"></div><div class="line">        A = <a class="code" href="group__rsb__doc__sparse__blas.html#ga144b8e13c62a239a3097256af7c09fcb">rsb_blas_file_mtx_load</a>(filename, typecode );</div><div class="line">        <span class="keywordflow">if</span>( A == <a class="code" href="blas__sparse_8h.html#a7cb10fb1b47b79ef278d6f09d571bd06a51022d3d696b9aee38d51040a5b01da7">blas_invalid_handle</a> )</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error while loading matrix %s from file.\n&quot;</span>,</div><div class="line">                                filename);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Correctly loaded and allocated a matrix&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; from file %s.\n&quot;</span>,filename);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="blas__sparse_8h.html#a5eec91b6d95962811bd9cb4e37266214">BLAS_usgp</a>(A,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63bad8275c5afad7cf56a0c1da44051a5fc0">blas_symmetric</a>) == 1 )</div><div class="line">                printf(<span class="stringliteral">&quot;Matrix is symmetric\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="blas__sparse_8h.html#a5eec91b6d95962811bd9cb4e37266214">BLAS_usgp</a>(A,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63ba1bf962e848b3f29d03d2bc341186a16c">blas_hermitian</a>) == 1 )</div><div class="line">                printf(<span class="stringliteral">&quot;Matrix is hermitian\n&quot;</span>);</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Now SPMV with NULL vectors will be attempted,&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; resulting in an error (so don&#39;t worry).\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__rsb__doc__sparse__blas.html#gad018cf218c2c938bb5cf4577f1b53319">BLAS_dusmv</a>(<a class="code" href="blas__sparse_8h.html#a23e5e138364c80074ac014a3dfd346b7a60c827bef60beeea296c26486e28d85f">blas_no_trans</a>,-1,A,NULL,1,NULL,1))</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Correctly detected an error condition.\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> okerr;</div><div class="line">        }</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;No error detected ?\nIf you see this line printed out,&quot;</span></div><div class="line">                <span class="stringliteral">&quot; please report as a bug, because the above NULL pointers&quot;</span></div><div class="line">                <span class="stringliteral">&quot; should have been detected\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line">okerr:</div><div class="line">        printf(<span class="stringliteral">&quot;Program correctly recovered from intentional&quot;</span></div><div class="line">                        <span class="stringliteral">&quot; error condition.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__rsb__doc__sparse__blas.html#ga8b0cca8196f40f7b55084a978b40717f">BLAS_usds</a>(A))</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error while freeing the matrix!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Correctly freed the matrix.\n&quot;</span>);</div><div class="line">err:</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__rsb__doc__rsb.html#gab660cf8aff876ae88b59c7a22ddfc912">rsb_perror</a>(NULL,</div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#ga86db30487afe975ed18a7aa6ee0db81d">rsb_lib_exit</a>(<a class="code" href="rsb_8h.html#a2234a5e51156de6c95c3f8c2951ae09f">RSB_NULL_EXIT_OPTIONS</a>))!=<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Failed finalizing the library.\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> ferr;</div><div class="line">        }</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Correctly finalized the library.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">ferr:</div><div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* RSB_NUMERICAL_TYPE_DOUBLE */</span><span class="preprocessor"></span></div><div class="line">}</div><div class="line"></div></div><!-- fragment --><p><a class="anchor" id="examples_transpose_c"></a> <a class="el" href="transpose_8c.html" title="A toy &lt;rsb.h&gt;-based C program showing instantiation, transposition and other operations on a single m...">examples/transpose.c</a>: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Copyright (C) 2008-2021 Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">This file is part of librsb.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">(at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span><span class="comment"></span></div><div class="line"><span class="comment">/*!</span></div><div class="line"><span class="comment"> @file</span></div><div class="line"><span class="comment"> @author Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> @brief A toy &lt;rsb.h&gt;-based C program showing instantiation,</span></div><div class="line"><span class="comment"> transposition and other operations on a single matrix.</span></div><div class="line"><span class="comment"> Uses \ref rsb_mtx_clone(), \ref rsb_file_mtx_save(),</span></div><div class="line"><span class="comment">  \ref rsb_file_mtx_get_dims(), \ref rsb_file_mtx_load().</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> \ingroup rsb_doc_examples</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> \include transpose.c</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rsb_8h.html">rsb.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span>      <span class="comment">/* printf */</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * <span class="keyword">const</span> argv[])</div><div class="line">{</div><div class="line">        <span class="keyword">struct </span>rsb_mtx_t *mtxAp = NULL;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#ac6a4411e32793f5c150c6ab3c6f7e14e">rsb_blk_idx_t</a> brA = <a class="code" href="rsb_8h.html#a3579d00f3b97cd569707f7c62e462322">RSB_DEFAULT_BLOCKING</a>,</div><div class="line">                            bcA = <a class="code" href="rsb_8h.html#a3579d00f3b97cd569707f7c62e462322">RSB_DEFAULT_BLOCKING</a>;</div><div class="line">        <a class="code" href="rsb_8h.html#a46b3366e54a5b4dda754a6ace22264df">rsb_nnz_idx_t</a> nnzA = 4;</div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>  nrA = 3;</div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>  ncA = 3;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>    IA[] = { 0, 1, 2, 0 };</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>    JA[] = { 0, 1, 2, 2 };</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> VA[] = { 11, 22, 33, 13 };</div><div class="line">        <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> XV[] = { 0,0,0,0,0,0 };</div><div class="line">        <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>  vl = 0;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#ac0f6a03345c8874f6e50f0ed033d984b">rsb_type_t</a> typecode = <a class="code" href="rsb__types_8h.html#a56fc5ef14266266227797621e0a1e217">RSB_NUMERICAL_TYPE_DEFAULT</a>;</div><div class="line">        <a class="code" href="rsb_8h.html#a640e84bcc5268cd92d5d31fd6ac321b8">rsb_err_t</a> errval = <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>;</div><div class="line"></div><div class="line">        <span class="comment">/* library initialization */</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__rsb__doc__rsb.html#gaf2b874d9f117ee6a6899634472b17946">rsb_lib_init</a>(<a class="code" href="rsb_8h.html#add105c42e570c5c269680d437f8c51e2">RSB_NULL_INIT_OPTIONS</a>)!=<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* allocation */</span></div><div class="line">        mtxAp = <a class="code" href="group__rsb__doc__rsb.html#ga86c1b0d0586f817ee31ca1caa3fee9be">rsb_mtx_alloc_from_coo_const</a>(</div><div class="line">                        VA,IA,JA,nnzA,typecode,nrA,ncA,</div><div class="line">                        brA,bcA,<a class="code" href="rsb_8h.html#a0ea7640214ee34c87e483c475b15827d">RSB_FLAG_NOFLAGS</a>,NULL);</div><div class="line">        <span class="keywordflow">if</span>(!mtxAp)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* printout */</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>!=(errval = <a class="code" href="group__rsb__doc__rsb.html#gad911ac7528c95c874d02cb17e6b76c54">rsb_file_mtx_save</a>(mtxAp,NULL)))</div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#accf836c8eb3145e9ab4fd277d6911764">RSB_ERR_UNSUPPORTED_FEATURE</a>)</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="comment">/* matrix transposition */</span></div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> != (errval =</div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#gae181671ba19191caa5a282cbde4fdfc5">rsb_mtx_clone</a>(&amp;mtxAp,<a class="code" href="rsb__types_8h.html#a532c3e9733221d59bac99cb1f795d266">RSB_NUMERICAL_TYPE_SAME_TYPE</a>,</div><div class="line">                <a class="code" href="rsb__types_8h.html#a37f8cea71946de2f832bdb9d438d5edf">RSB_TRANSPOSITION_T</a>,NULL,mtxAp,<a class="code" href="rsb_8h.html#aacf404fe630d480353ce767fd27ba097">RSB_FLAG_IDENTICAL_FLAGS</a>)))</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* printout */</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>!=(errval = <a class="code" href="group__rsb__doc__rsb.html#gad911ac7528c95c874d02cb17e6b76c54">rsb_file_mtx_save</a>(mtxAp,NULL)))</div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#accf836c8eb3145e9ab4fd277d6911764">RSB_ERR_UNSUPPORTED_FEATURE</a>)</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab64a020286a8b58d23d84d4512bd9132">rsb_mtx_free</a>(mtxAp);</div><div class="line"></div><div class="line">        <span class="comment">/* doing the same after load from file */</span></div><div class="line">        mtxAp = <a class="code" href="group__rsb__doc__rsb.html#ga00833b0cf57da8e430f9d0e2b5375bb3">rsb_file_mtx_load</a>(<span class="stringliteral">&quot;pd.mtx&quot;</span>,</div><div class="line">                <a class="code" href="rsb_8h.html#a0ea7640214ee34c87e483c475b15827d">RSB_FLAG_NOFLAGS</a>,typecode,NULL);</div><div class="line">        <span class="keywordflow">if</span>(!mtxAp)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* printout */</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>!=(errval = <a class="code" href="group__rsb__doc__rsb.html#gad911ac7528c95c874d02cb17e6b76c54">rsb_file_mtx_save</a>(mtxAp,NULL)))</div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#accf836c8eb3145e9ab4fd277d6911764">RSB_ERR_UNSUPPORTED_FEATURE</a>)</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* one can see dimensions in advance, also */</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>!=(errval =</div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#gaa79f69918eafbd8f737b7866a00a0330">rsb_file_mtx_get_dims</a>(<span class="stringliteral">&quot;pd.mtx&quot;</span>,&amp;nrA,&amp;ncA,&amp;nnzA,NULL)))</div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(errval != <a class="code" href="rsb_8h.html#accf836c8eb3145e9ab4fd277d6911764">RSB_ERR_UNSUPPORTED_FEATURE</a>)</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* A matrix can be rendered to Postscript. */</span></div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>!=(errval =</div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#gab0702d7080d1699162e4201bc70cc5ee">rsb_mtx_rndr</a>(<span class="stringliteral">&quot;pd.eps&quot;</span>,mtxAp,512,512,<a class="code" href="rsb_8h.html#a77106fe2435306ef028060d0eb7dca14">RSB_MARF_EPS_B</a>)))</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab64a020286a8b58d23d84d4512bd9132">rsb_mtx_free</a>(mtxAp);</div><div class="line"></div><div class="line">        <span class="comment">/* also vectors can be loaded */</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>!=(errval = </div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#gad071e0373a08f74ee7ae910e9e4fd140">rsb_file_vec_load</a>(<span class="stringliteral">&quot;vf.mtx&quot;</span>,typecode,NULL,&amp;vl )))</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        <span class="comment">/* we expect vf.mtx to be 6 rows long */</span></div><div class="line">        <span class="keywordflow">if</span>( vl != 6 )</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>!=(errval = </div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#gad071e0373a08f74ee7ae910e9e4fd140">rsb_file_vec_load</a>(<span class="stringliteral">&quot;vf.mtx&quot;</span>,typecode,XV, NULL )))</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">        <span class="comment">/* matrices can be rendered from file to a pixelmap as well */</span></div><div class="line">        {</div><div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pixmap[3*2*2];</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>!=(errval =</div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#ga4b45a74b985f5cbd869bc9a540951771">rsb_file_mtx_rndr</a>(pixmap,<span class="stringliteral">&quot;pd.mtx&quot;</span>,2,2,2,<a class="code" href="rsb_8h.html#a53604f78febc54c616282c66bca02daf">RSB_MARF_RGB</a>)))</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> != <a class="code" href="group__rsb__doc__rsb.html#ga86db30487afe975ed18a7aa6ee0db81d">rsb_lib_exit</a>(<a class="code" href="rsb_8h.html#a2234a5e51156de6c95c3f8c2951ae09f">RSB_NULL_EXIT_OPTIONS</a>))</div><div class="line">        {</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">err:</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab660cf8aff876ae88b59c7a22ddfc912">rsb_perror</a>(NULL,errval);</div><div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line">}</div><div class="line"></div></div><!-- fragment --><p><a class="anchor" id="examples_power_c"></a> <a class="el" href="power_8c.html" title="A toy &lt;rsb.h&gt;-based C program implementing the power method for computing matrix eigenvalues. Uses rsb_spmv(). ">examples/power.c</a>: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Copyright (C) 2008-2021 Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">This file is part of librsb.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">(at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span><span class="comment"></span></div><div class="line"><span class="comment">/*!</span></div><div class="line"><span class="comment"> @file</span></div><div class="line"><span class="comment"> @author Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> @brief A toy &lt;rsb.h&gt;-based C program implementing the power</span></div><div class="line"><span class="comment">        method for computing matrix eigenvalues. Uses #rsb_spmv().</span></div><div class="line"><span class="comment"> \ingroup rsb_doc_examples</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> \include power.c</span></div><div class="line"><span class="comment">*/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span>      <span class="comment">// printf</span></div><div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span>       <span class="comment">// sqrt</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span>     <span class="comment">// calloc</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rsb_8h.html">rsb.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * <span class="keyword">const</span> argv[])</div><div class="line">{</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> WANT_VERBOSE = 0;</div><div class="line">        <span class="keyword">struct </span>rsb_mtx_t *mtxAp = NULL;</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> bs = <a class="code" href="rsb_8h.html#a3579d00f3b97cd569707f7c62e462322">RSB_DEFAULT_BLOCKING</a>;</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> br = bs, bc = bs; <span class="comment">/* bs x bs blocked */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a46b3366e54a5b4dda754a6ace22264df">rsb_nnz_idx_t</a> nnzA = 4;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>  nrA = 3;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>  ncA = 3;</div><div class="line">        <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> it = 0;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> maxit = 100;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>    IA[] = { 0, 1, 2, 0 };</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a>    JA[] = { 0, 1, 2, 2 };</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#ae7da5c374c2384c32084fc50ede06a4e">RSB_DEFAULT_POSSIBLY_FIRST_BLAS_TYPE</a> VA[] = { 11, 22, 33, 13 };</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#ae7da5c374c2384c32084fc50ede06a4e">RSB_DEFAULT_POSSIBLY_FIRST_BLAS_TYPE</a> ZERO = 0;</div><div class="line">        <span class="keywordtype">int</span> i;</div><div class="line">        <a class="code" href="rsb_8h.html#a640e84bcc5268cd92d5d31fd6ac321b8">rsb_err_t</a> errval = 0;</div><div class="line"></div><div class="line">        <a class="code" href="rsb__types_8h.html#ae7da5c374c2384c32084fc50ede06a4e">RSB_DEFAULT_POSSIBLY_FIRST_BLAS_TYPE</a> norm = 0.0, <span class="comment">/* nu */</span></div><div class="line">                oldnorm = 1.0, <span class="comment">/* oldnorm */</span></div><div class="line">                *b1 = NULL, *b2 = NULL,</div><div class="line">                *bnow = NULL, *bnext = NULL;<span class="comment">/* b1 and b2 aliases */</span></div><div class="line">        <a class="code" href="rsb_8h.html#ac0f6a03345c8874f6e50f0ed033d984b">rsb_type_t</a> typecode = <a class="code" href="rsb__types_8h.html#ac51619f9cbe0a9a4cbc55e0451bfb59d">RSB_NUMERICAL_TYPE_FIRST_BLAS</a>;</div><div class="line">        <span class="keywordtype">size_t</span> ds = 0;</div><div class="line">        <span class="comment">/* tolerance */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#ae7da5c374c2384c32084fc50ede06a4e">RSB_DEFAULT_POSSIBLY_FIRST_BLAS_TYPE</a> tol = 1e-14;</div><div class="line"></div><div class="line">        <span class="comment">/* library initialization */</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__rsb__doc__rsb.html#gaf2b874d9f117ee6a6899634472b17946">rsb_lib_init</a>(<a class="code" href="rsb_8h.html#add105c42e570c5c269680d437f8c51e2">RSB_NULL_INIT_OPTIONS</a>)!=<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">                <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line"></div><div class="line">        <span class="comment">/* allocation */</span></div><div class="line">        mtxAp = <a class="code" href="group__rsb__doc__rsb.html#ga86c1b0d0586f817ee31ca1caa3fee9be">rsb_mtx_alloc_from_coo_const</a>(VA,IA,JA,nnzA,</div><div class="line">                        typecode,nrA,ncA,br,bc,<a class="code" href="rsb_8h.html#a0ea7640214ee34c87e483c475b15827d">RSB_FLAG_NOFLAGS</a>,NULL);</div><div class="line">        <span class="keywordflow">if</span>(!mtxAp)</div><div class="line">                <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line"></div><div class="line">        ds = (nrA)*<span class="keyword">sizeof</span>(<a class="code" href="rsb__types_8h.html#ae7da5c374c2384c32084fc50ede06a4e">RSB_DEFAULT_POSSIBLY_FIRST_BLAS_TYPE</a>);</div><div class="line">        b1 = calloc(1,ds);</div><div class="line">        b2 = calloc(1,ds);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(! (b1 &amp;&amp; b2))</div><div class="line">        {</div><div class="line">                errval = <a class="code" href="rsb_8h.html#a538215b32e908646c979a2e446ae5467">RSB_ERR_ENOMEM</a>;</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span>( i = 0; i &lt; nrA; ++i )</div><div class="line">                b1[i] = 1;</div><div class="line"></div><div class="line">        bnow = b1, bnext = b2;<span class="comment">/* b,b&#39; */</span></div><div class="line"></div><div class="line">        <span class="keywordflow">while</span>( fabs(norm-oldnorm) &gt; tol &amp;&amp; it&lt;maxit )</div><div class="line">        {</div><div class="line">                ++ it;</div><div class="line">                oldnorm = norm;</div><div class="line">                <span class="comment">/* b&#39;&lt;-Ab */</span></div><div class="line">                <span class="keywordflow">if</span>(( <a class="code" href="group__rsb__doc__rsb.html#ga4a16a82d289c76a437915db449553d4d">rsb_spmv</a>(<a class="code" href="rsb__types_8h.html#a9673f34330af77b1c0fd4a585e0c62cc">RSB_TRANSPOSITION_N</a>,NULL,mtxAp,bnow,</div><div class="line">                        1,&amp;ZERO,bnext,1)) != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line">                <span class="comment">/* nu&lt;-||Ab||^2 */</span></div><div class="line">                norm = 0;</div><div class="line">                <span class="keywordflow">for</span>(i=0;i&lt;nrA;++i) </div><div class="line">                        norm += bnext[i]*bnext[i];</div><div class="line">                <span class="comment">/* nu&lt;-||Ab|| */</span></div><div class="line">                norm = sqrt(norm);</div><div class="line">                norm = 1.0/norm;</div><div class="line">                <span class="comment">/* b&#39;&lt;- Ab / ||Ab|| */</span></div><div class="line">                <span class="keywordflow">for</span>(i=0;i&lt;nrA;++i)</div><div class="line">                        bnext[i] *= norm;</div><div class="line">                norm = 1.0/norm;</div><div class="line">                printf(<span class="stringliteral">&quot;it:%d norm:%lg norm diff:%lg\n&quot;</span>,it,norm,norm-oldnorm);</div><div class="line"></div><div class="line">                {<span class="keywordtype">void</span> *tmp=bnow;bnow=bnext;bnext=tmp;<span class="comment">/* pointers swap */</span>}</div><div class="line">                <span class="keywordflow">if</span>(WANT_VERBOSE)</div><div class="line">                {</div><div class="line">                        printf(<span class="stringliteral">&quot;norm:%lg\n&quot;</span>,norm);</div><div class="line">                        <span class="keywordflow">if</span>(isinf(norm))</div><div class="line">                        <span class="comment">/* isinf is a C99 feature (need correct</span></div><div class="line"><span class="comment">                         * compilation flags) */</span></div><div class="line">                                <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">                        <span class="keywordflow">for</span>(i=0;i&lt;2;++i)</div><div class="line">                                printf(<span class="stringliteral">&quot;x[%d]=%lg\n&quot;</span>,i,((<span class="keywordtype">double</span>*)bnext)[i]);</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="comment">/* the biggest eigenvalue should be in bnow */</span></div><div class="line"></div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab64a020286a8b58d23d84d4512bd9132">rsb_mtx_free</a>(mtxAp);</div><div class="line">        free(b1);</div><div class="line">        free(b2);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__rsb__doc__rsb.html#ga86db30487afe975ed18a7aa6ee0db81d">rsb_lib_exit</a>(<a class="code" href="rsb_8h.html#a2234a5e51156de6c95c3f8c2951ae09f">RSB_NULL_EXIT_OPTIONS</a>)!=<a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        <span class="keywordflow">if</span>( it == maxit )</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;ERROR: hit iterations limit without convergence!&quot;</span>);</div><div class="line">                errval=<a class="code" href="rsb_8h.html#ad46ebc803d7cad695babdc7d8c709828">RSB_ERR_GENERIC_ERROR</a>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">err:</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab660cf8aff876ae88b59c7a22ddfc912">rsb_perror</a>(NULL,errval);</div><div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line">}</div><div class="line"></div></div><!-- fragment --><p><a class="anchor" id="examples_fortran_F90"></a> <a class="el" href="fortran_8F90.html" title="Sparse BLAS-based usage: uscr_begin(), usgp(), ussp(), usmv(), ... ">examples/fortran.F90</a>: </p><div class="fragment"><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! Copyright (C) 2008-2022 Michele Martone</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! This file is part of librsb.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">! under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">! by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">! (at your option) any later version.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">! ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">! FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">! License for more details.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">! License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">! If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">!&gt; @file</span></div><div class="line"><span class="comment">!! @brief Sparse BLAS-based usage:</span></div><div class="line"><span class="comment">!!  uscr_begin(), usgp(), ussp(), usmv(), ...</span></div><div class="line"><span class="comment">!! \include fortran.F90</span></div><div class="line"></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran_8F90.html#a9e8daa274f041cb50f75d64028e079ba">blas_sparse_mod_example</a>(res)</div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespaceblas__sparse.html">blas_sparse</a></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a> <span class="comment">! For the second part of the example and RSB_IDX_KIND</span></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: i, j</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_BLAS_IDX_KIND)</span> :: istat = 0, res</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">TARGET</span> :: mtxap = c_null_ptr <span class="comment">! matrix pointer</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: a</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">PARAMETER</span> :: transn = <a class="code" href="blas__sparse_8h.html#a23e5e138364c80074ac014a3dfd346b7a60c827bef60beeea296c26486e28d85f">blas_no_trans</a></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: incx = 1</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: incy = 1</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">PARAMETER</span> :: alpha = 3</div><div class="line"><span class="comment">! Symmetric (declared via lower triangle) matrix based example, e.g.:</span></div><div class="line"><span class="comment">! 1 0</span></div><div class="line"><span class="comment">! 1 1</span></div><div class="line">      <span class="comment">! declaration of VA,IA,JA </span></div><div class="line">      <span class="comment">!INTEGER,PARAMETER :: nr = 100</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nr = 20</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nc = nr</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nnz = (nr*(nr+1))/2 <span class="comment">! half the square</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nrhs = 1</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nt = 0</div><div class="line">      <span class="keywordtype">INTEGER</span> :: ic, ir</div><div class="line">      <span class="comment">! For compatibility with (or compassion for) flang-13, we turn these three lines off:</span></div><div class="line">      <span class="comment">! REAL(KIND=8),PARAMETER :: VA(nnz) = (/ ((1, ic=1,ir), ir=1,nr ) /) ! (/1, 1, 1/)</span></div><div class="line">      <span class="comment">! INTEGER(KIND=RSB_IDX_KIND),PARAMETER :: IA(nnz) = (/ (((ir), ic=1,ir), ir=1,nr ) /) ! (/1, 2, 2/)</span></div><div class="line">      <span class="comment">! INTEGER(KIND=RSB_IDX_KIND),PARAMETER :: JA(nnz) = (/ (((ic), ic=1,ir), ir=1,nr ) /) ! (/1, 1, 2/)</span></div><div class="line">      <span class="comment">! and use these other ones instead, initializing VA,IA,JA later:</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span> :: va(nnz)</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: ia(nnz)</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: ja(nnz)</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span> :: x(nc,nrhs) = reshape((/((1), ic=1,nc*nrhs)/),[nc,nrhs]) <span class="comment">! reference x ! (/1, 1/)</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">PARAMETER</span> :: cy(nr,nrhs) = reshape((/((alpha+alpha*nr), ir=1,nr*nrhs)/),[nr,nrhs]) <span class="comment">! reference cy after ! (/9, 9/)</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span> :: y(nr,nrhs) = reshape((/((alpha), ir=1,nr*nrhs)/),[nr,nrhs]) <span class="comment">! y will be overwritten ! (/3, 3/)</span></div><div class="line">      va(:) = (/ ((1, ic=1,ir), ir=1,nr ) /) <span class="comment">! (/1, 1, 1/)</span></div><div class="line">      ia(:) = (/ (((ir), ic=1,ir), ir=1,nr ) /) <span class="comment">! (/1, 2, 2/)</span></div><div class="line">      ja(:) = (/ (((ic), ic=1,ir), ir=1,nr ) /) <span class="comment">! (/1, 1, 2/)</span></div><div class="line">      <span class="comment">! First example part: pure blas_sparse code.</span></div><div class="line">      res = 0</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#acf14608f8b0375ca133b7f850bde3b50">duscr_begin</a>(nr,nc,a,res)</div><div class="line">      <span class="keywordflow">IF</span> (res.NE.0) <span class="keywordflow">GOTO</span> 9999</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63baba96b7c19a0ccfe3be9d78cb27690487">blas_lower_symmetric</a>,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729ae05ed12240987c33f90ee6cf012985a0">blas_rsb_spmv_autotuning_on</a>,istat) <span class="comment">! (experimental) turns auto-tuning + thread setting on</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) print *,<span class="stringliteral">&quot;autotuning returned nonzero:&quot;</span>, istat &amp;</div><div class="line">       &amp;,<span class="stringliteral">&quot; ...did you enable autotuning ?&quot;</span></div><div class="line">      <span class="comment">!</span></div><div class="line">      <span class="comment">! First style example </span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1uscr__insert__entries.html">uscr_insert_entries</a>(a,nnz,va,ia,ja,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a48f1e1b82322910d45a1b2455421745f">uscr_end</a>(a,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="comment">! CALL ussp(A,blas_rsb_duplicates_sum,istat)</span></div><div class="line">      <span class="comment">! CALL uscr_insert_entries(A,nnz,VA,IA,JA,istat) ! uncomment this to activate add of coefficients to pattern</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729ae05ed12240987c33f90ee6cf012985a0">blas_rsb_spmv_autotuning_on</a>,nt)  <span class="comment">! (experimental)</span></div><div class="line">      <span class="keywordflow">IF</span> (nt.NE.0) print*,<span class="stringliteral">&quot;autotuner chose &quot;</span>,nt,<span class="stringliteral">&quot; threads&quot;</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729addbb7f37e0069794e22567ce9c58a1a7">blas_rsb_spmv_autotuning_off</a>,istat) <span class="comment">! (experimental) turns auto-tuning + thread setting off</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">        <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmv.html">usmv</a>(transn,alpha,a,x(:,j),incx,y(:,j),incy,istat)</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="comment">!</span></div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">      <span class="keywordflow">DO</span> i = 1, nr</div><div class="line">        <span class="keywordflow">IF</span> (y(i,j).NE.cy(i,j)) print *, <span class="stringliteral">&quot;first check results are not ok&quot;</span></div><div class="line">        <span class="keywordflow">IF</span> (y(i,j).NE.cy(i,j)) <span class="keywordflow">GOTO</span> 9997</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="comment">!</span></div><div class="line">      y(:,:) = alpha <span class="comment">! reset</span></div><div class="line">      <span class="comment">!</span></div><div class="line">      <span class="comment">! Second style example </span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729ac88f907f61c86a61837a37274e2f97d4">blas_rsb_autotune_next_operation</a>,istat) <span class="comment">! (experimental) turns auto-tuning + thread setting on</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">        <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmv.html">usmv</a>(transn,alpha,a,x(:,j),incx,y(:,j),incy,istat)</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs, alpha,a,x,nr,y,nc,istat) <span class="comment">! Equivalent to the above (as long as incx=incy=1).</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs,-alpha,a,x,nr,y,nc,istat) <span class="comment">! Subtract the last usmm call contribution.</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="comment">!</span></div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">      <span class="keywordflow">DO</span> i = 1, nr</div><div class="line">        <span class="keywordflow">IF</span> (y(i,j).NE.cy(i,j)) print *,<span class="stringliteral">&quot;second check results are not ok&quot;</span></div><div class="line">        <span class="keywordflow">IF</span> (y(i,j).NE.cy(i,j)) <span class="keywordflow">GOTO</span> 9997</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="comment">!</span></div><div class="line">      print *, <span class="stringliteral">&quot;check results are ok&quot;</span></div><div class="line">      </div><div class="line">      <span class="comment">! Second part of the example: access to the rsb.h interface via</span></div><div class="line">      <span class="comment">! the ISO C Binding interface.</span></div><div class="line">      mtxap = <a class="code" href="interfaceblas__sparse_1_1rsb__blas__get__mtx.html">rsb_blas_get_mtx</a>(a) <span class="comment">! get pointer to rsb structure (as in the rsb.h API)</span></div><div class="line">      <span class="keywordflow">IF</span>(nr.LT.5) istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char) <span class="comment">! write to stdout (only if matrix small enough)</span></div><div class="line"></div><div class="line">      <span class="keywordflow">GOTO</span> 9998</div><div class="line">9997      res = -1</div><div class="line">9998      <span class="keywordflow">CONTINUE</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a8a3b6cd055048ab5e15b1b18be291f32">usds</a>(a,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) res = -1</div><div class="line">9999      <span class="keywordflow">CONTINUE</span></div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran_8F90.html#a9e8daa274f041cb50f75d64028e079ba">blas_sparse_mod_example</a></div><div class="line"></div><div class="line">      <span class="comment">! Example loading a matrix from file and measuring SPMM.</span></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran_8F90.html#a5afdd9925e3262966d4dde1fed40cca8">blas_sparse_io_example</a>(res)</div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespaceblas__sparse.html">blas_sparse</a></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a> <span class="comment">! For rsb_blas_file_mtx_load</span></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: res <span class="comment">! note: same as RSB_BLAS_IDX_KIND</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: j</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_BLAS_IDX_KIND)</span> :: istat = 0</div><div class="line">      <span class="keywordtype">INTEGER</span> :: a</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">PARAMETER</span> :: transn = <a class="code" href="blas__sparse_8h.html#a23e5e138364c80074ac014a3dfd346b7a60c827bef60beeea296c26486e28d85f">blas_no_trans</a></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: incx = 1</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: incy = 1</div><div class="line">      <span class="keywordtype">COMPLEX(KIND=8)</span>,<span class="keywordtype">PARAMETER</span> :: alpha = 3</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nr</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nc</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nz</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: st</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nrhs = 4</div><div class="line">      <span class="keywordtype">COMPLEX(KIND=8)</span>, <span class="keywordtype">ALLOCATABLE</span>, <span class="keywordtype">TARGET</span>, <span class="keywordtype">DIMENSION(:,:)</span> :: x</div><div class="line">      <span class="keywordtype">COMPLEX(KIND=8)</span>, <span class="keywordtype">ALLOCATABLE</span>, <span class="keywordtype">TARGET</span>, <span class="keywordtype">DIMENSION(:,:)</span> :: y</div><div class="line">      <span class="keywordtype">CHARACTER(KIND=C_CHAR,LEN=7)</span>,<span class="keywordtype">TARGET</span> :: filename = <span class="stringliteral">&#39;pd.mtx&#39;</span>//c_null_char</div><div class="line">      <span class="keywordtype">INTEGER(C_SIGNED_CHAR)</span> :: typecode = <a class="code" href="namespacersb.html#a1865b95dcc4fac4f0fe21dfe8c4ef036">rsb_numerical_type_double_complex</a></div><div class="line">      <span class="keywordtype">REAL(KIND=C_DOUBLE)</span> :: mvt,mmt,omt</div><div class="line">      <span class="keywordtype">INTEGER(KIND=C_INT)</span>,<span class="keywordtype">TARGET</span>::izero=0</div><div class="line"></div><div class="line">      res = 0</div><div class="line"></div><div class="line">      a = <a class="code" href="interfacersb_1_1rsb__blas__file__mtx__load.html">rsb_blas_file_mtx_load</a>(filename, typecode);</div><div class="line">      <span class="keywordflow">IF</span> (a.EQ.<a class="code" href="blas__sparse_8h.html#a7cb10fb1b47b79ef278d6f09d571bd06a51022d3d696b9aee38d51040a5b01da7">blas_invalid_handle</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a540f6a907f9f5e49d84a65c530e598c6ace8432d9075d2530ffc0b474c5560e23">blas_num_rows</a>,nr)</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a540f6a907f9f5e49d84a65c530e598c6a9b8cd10d952e1405feeac4f81e3b9f4b">blas_num_cols</a>,nc)</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a540f6a907f9f5e49d84a65c530e598c6a1968168c04860e3bb4ed8eb3232084fd">blas_num_nonzeros</a>,nz)</div><div class="line"></div><div class="line">      print*,<span class="stringliteral">&quot;Read matrix &quot;</span>,filename(1:6),<span class="stringliteral">&quot; &quot;</span>,nr,<span class="stringliteral">&quot;x&quot;</span>,nc,<span class="stringliteral">&quot;:&quot;</span>,nz</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63bab56e7dc16e197ab01f48a53c3f866866">blas_general</a>,st)</div><div class="line">      <span class="keywordflow">IF</span> (st .EQ. 1) print*,<span class="stringliteral">&quot;Matrix has no symmetry&quot;</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63ba2ac709e94a120358c4bbd620ec8888de">blas_upper_symmetric</a>,st)</div><div class="line">      <span class="keywordflow">IF</span> (st .EQ. 1) print*,<span class="stringliteral">&quot;Matrix is upper symmetric&quot;</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63ba5377bb47a85d04c507e8883f8c17d1fe">blas_upper_hermitian</a>,st)</div><div class="line">      <span class="keywordflow">IF</span> (st .EQ. 1) print*,<span class="stringliteral">&quot;Matrix is upper hermitian&quot;</span></div><div class="line">      <span class="comment">! ...</span></div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,i0)&#39;</span>) <span class="stringliteral">&quot;Using NRHS=&quot;</span>,nrhs</div><div class="line">      <span class="keyword">ALLOCATE</span>( x(nc,nrhs))</div><div class="line">      <span class="keyword">ALLOCATE</span>( y(nr,nrhs))</div><div class="line">      x = 1.0</div><div class="line"></div><div class="line">      y = 0.0</div><div class="line">      mvt = -<a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">        <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmv.html">usmv</a>(transn,alpha,a,x(:,j),incx,y(:,j),incy,istat)</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      mvt = mvt + <a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,e12.4,a)&#39;</span>) <span class="stringliteral">&quot;Repeated USMV took &quot;</span>,mvt,<span class="stringliteral">&quot; s&quot;</span></div><div class="line">      </div><div class="line">      y = 0.0</div><div class="line">      mmt = -<a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs, alpha,a,x,nr,y,nc,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      mmt = mmt + <a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,e12.4,a)&#39;</span>) <span class="stringliteral">&quot;A single USMM took &quot;</span>,mmt,<span class="stringliteral">&quot; s&quot;</span></div><div class="line"></div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,g11.4,a)&#39;</span>)<span class="stringliteral">&quot;USMM-to-USMV speed ratio is is &quot;</span>, mvt/mmt, <span class="stringliteral">&quot;x&quot;</span></div><div class="line"></div><div class="line">      print*,<span class="stringliteral">&quot;Call auto-tuning routine..&quot;</span></div><div class="line">      <span class="comment">! Change IZERO value to 1 to get verbose tuning again.</span></div><div class="line">      res = <a class="code" href="interfacersb_1_1rsb__lib__set__opt.html">rsb_lib_set_opt</a>(<a class="code" href="namespacersb.html#ac95404408be9bc2045e8455881d21377">rsb_io_want_verbose_tuning</a>,c_loc(izero))</div><div class="line">      <span class="keywordflow">IF</span> (res.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729ac88f907f61c86a61837a37274e2f97d4">blas_rsb_autotune_next_operation</a>,istat) <span class="comment">! (experimental) turns auto-tuning + thread setting on</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs, alpha,a,x,nr,y,nc,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      print*,<span class="stringliteral">&quot;Repeat measurement.&quot;</span></div><div class="line">      y = 0.0</div><div class="line">      omt = -<a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs, alpha,a,x,nr,y,nc,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      omt = omt + <a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,e12.4,a)&#39;</span>) <span class="stringliteral">&quot;Tuned USMM took &quot;</span>,omt,<span class="stringliteral">&quot; s&quot;</span></div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,g11.4,a)&#39;</span>)<span class="stringliteral">&quot;Tuned-to-untuned speed ratio is is &quot;</span>,mmt/omt,<span class="stringliteral">&quot;x&quot;</span></div><div class="line">      </div><div class="line">      <span class="keywordflow">GOTO</span> 9998</div><div class="line">9997      res = -1</div><div class="line">9998      <span class="keywordflow">CONTINUE</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a8a3b6cd055048ab5e15b1b18be291f32">usds</a>(a,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) res = -1</div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran_8F90.html#a5afdd9925e3262966d4dde1fed40cca8">blas_sparse_io_example</a></div><div class="line"></div><div class="line">      <span class="keyword">PROGRAM</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a><span class="keywordtype">, ONLY</span>: <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>, <a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>, c_ptr, c_null_ptr,&amp;</div><div class="line">       &amp; <a class="code" href="namespacersb.html#a191f5492907ae4beca111b361955a791">rsb_io_want_extra_verbose_interface</a>,<a class="code" href="namespacersb.html#ac95404408be9bc2045e8455881d21377">rsb_io_want_verbose_tuning</a>,&amp;</div><div class="line">       &amp; <a class="code" href="interfacersb_1_1rsb__lib__set__opt.html">rsb_lib_set_opt</a>,<a class="code" href="namespacersb.html#a08c81f98d0bbd02f10c72b9d2c53e549">rsb_idx_kind</a></div><div class="line">      <span class="comment">! USE blas_sparse, only: RSB_BLAS_IDX_KIND ! only if using long indices</span></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: passed = 0, failed = 0</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: res <span class="comment">! note: same as RSB_BLAS_IDX_KIND</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: EO = RSB_NULL_EXIT_OPTIONS</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: IO = RSB_NULL_INIT_OPTIONS</span></div><div class="line">      <span class="comment">! Note: using C_NULL_PTR instead of the previous lines because of http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59411</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: eo = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: io = c_null_ptr</div><div class="line">      <span class="keywordtype">INTEGER(KIND=C_INT)</span>,<span class="keywordtype">TARGET</span>::ione=1</div><div class="line">      res = <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>(io)</div><div class="line">      res = <a class="code" href="interfacersb_1_1rsb__lib__set__opt.html">rsb_lib_set_opt</a>(<a class="code" href="namespacersb.html#ac95404408be9bc2045e8455881d21377">rsb_io_want_verbose_tuning</a>,c_loc(ione))</div><div class="line">      </div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran_8F90.html#a9e8daa274f041cb50f75d64028e079ba">blas_sparse_mod_example</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran_8F90.html#a5afdd9925e3262966d4dde1fed40cca8">blas_sparse_io_example</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line"></div><div class="line">      res = <a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>(eo)</div><div class="line">      </div><div class="line">      print *, <span class="stringliteral">&quot;FAILED:&quot;</span>, failed</div><div class="line">      print *, <span class="stringliteral">&quot;PASSED:&quot;</span>, passed</div><div class="line">      <span class="keywordflow">IF</span> (failed .GT. 0) <span class="keywordflow">THEN</span></div><div class="line">       stop 1</div><div class="line"><span class="keywordflow">      END IF</span></div><div class="line"><span class="keyword">      END PROGRAM</span></div></div><!-- fragment --><p><a class="anchor" id="examples_fortran_rsb_fi_F90"></a> <a class="el" href="fortran__rsb__fi_8F90.html" title="RSB.F90-based usage: rsb_mtx_alloc_from_coo_const(), rsb_tune_spmm(), rsb_file_mtx_save(), rsb_spmv(), ... ">examples/fortran_rsb_fi.F90</a>: </p><div class="fragment"><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! Copyright (C) 2008-2022 Michele Martone</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! This file is part of librsb.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">! under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">! by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">! (at your option) any later version.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">! ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">! FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">! License for more details.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">! License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">! If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">!&gt; @file.</span></div><div class="line"><span class="comment">!! @brief RSB.F90-based usage:</span></div><div class="line"><span class="comment">!!        rsb_mtx_alloc_from_coo_const(),</span></div><div class="line"><span class="comment">!!        rsb_tune_spmm(),</span></div><div class="line"><span class="comment">!!        rsb_file_mtx_save(),</span></div><div class="line"><span class="comment">!!        rsb_spmv(),</span></div><div class="line"><span class="comment">!!        ...</span></div><div class="line"><span class="comment">!! \include fortran_rsb_fi.F90</span></div><div class="line"></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#a81bb92e0655a22d251331911eea093ba">rsb_mod_example1</a>(res)</div><div class="line"><span class="comment">! Example using an unsymmetric matrix specified as COO, and autotuning, built at once.</span></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> ::res</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: istat = 0, i</div><div class="line">      <span class="keywordtype">INTEGER</span> :: transt = <a class="code" href="namespacersb.html#a89c7627f24fecaf23ead8300f671314f">rsb_transposition_n</a> <span class="comment">!</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: incx = 1, incy = 1</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: alpha = 3, beta = 1</div><div class="line"><span class="comment">! 1 1</span></div><div class="line"><span class="comment">! 1 1</span></div><div class="line">      <span class="comment">! declaration of VA,IA,JA </span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nnz = 4</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nr = 2</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nc = 2</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nrhs = 1</div><div class="line">      <span class="keywordtype">INTEGER</span> :: order = <a class="code" href="namespacersb.html#a8786a38b2ca41b926b8ef6092a55b8a6">rsb_flag_want_column_major_order</a> <span class="comment">! rhs layout</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: flags = <a class="code" href="namespacersb.html#a65dbcb1d6e6347e5b7e85b5aa49db90c">rsb_flag_noflags</a> </div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ia(4) = (/0, 1, 1,0/)</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ja(4) = (/0, 0, 1,1/)</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: va(4) = (/1,1,1,1/)</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: x(2) = (/1, 1/)<span class="comment">! reference x </span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: cy(2) = (/9, 9/)<span class="comment">! reference cy after </span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: y(2) = (/3, 3/)<span class="comment">! y will be overwritten</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">TARGET</span> :: mtxap = c_null_ptr <span class="comment">! matrix pointer</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span> :: tmax = 2.0 <span class="comment">! tuning max time</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: titmax = 2 <span class="comment">! tuning max iterations</span></div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: ont = 0     <span class="comment">! optimal number of threads</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: EO = RSB_NULL_EXIT_OPTIONS</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: IO = RSB_NULL_INIT_OPTIONS</span></div><div class="line">      <span class="comment">! Note: using C_NULL_PTR instead of the previous lines because of http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59411</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: eo = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: io = c_null_ptr</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: errval</div><div class="line"></div><div class="line">      res = 0</div><div class="line"></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>(io)</div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__alloc__from__coo__const.html">rsb_mtx_alloc_from_coo_const</a>(c_loc(va),c_loc(ia),c_loc(ja)&amp;</div><div class="line">       &amp;,nnz,&amp;</div><div class="line">       &amp; <a class="code" href="namespacersb.html#af833bb7a31acb188d33424c3c16bd4cd">rsb_numerical_type_double</a>,nr,nc,1,1,flags,c_loc(istat))</div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char)</div><div class="line"></div><div class="line">      <span class="comment">! Structure autotuning:</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__tune__spmm.html">rsb_tune_spmm</a>(c_loc(mtxap),c_null_ptr,c_null_ptr,titmax,&amp;</div><div class="line">       &amp; tmax,&amp;</div><div class="line">       &amp; transt,c_loc(alpha),c_null_ptr,nrhs,order,c_loc(x),nr,&amp;</div><div class="line">       &amp; c_loc(beta),c_loc(y),nc)</div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      <span class="comment">! Thread count autotuning:</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__tune__spmm.html">rsb_tune_spmm</a>(c_null_ptr,c_null_ptr,c_loc(ont),titmax,&amp;</div><div class="line">       &amp; tmax,&amp;</div><div class="line">       &amp; transt,c_loc(alpha),mtxap,nrhs,order,c_loc(x),nr,c_loc(beta),&amp;</div><div class="line">       &amp; c_loc(y),nc)</div><div class="line">      print *, <span class="stringliteral">&quot;Optimal number of threads:&quot;</span>, ont</div><div class="line"></div><div class="line">      y(:) = (/3, 3/)<span class="comment">! restoring reference y (rsb_tune_spmm has overwritten it)</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      </div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__spmv.html">rsb_spmv</a>(transt,c_loc(alpha),mtxap,c_loc(x),incx,&amp;</div><div class="line">       &amp; c_loc(beta),c_loc(y),incy)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keywordflow">DO</span> i = 1, 2</div><div class="line">            <span class="keywordflow">IF</span> (y(i).NE.cy(i)) print *, <span class="stringliteral">&quot;type=d dims=2x2 sym=g diag=g &amp;</span></div><div class="line"><span class="stringliteral"></span><span class="stringliteral">      &amp;blocks=1x1 usmv alpha= 3 beta= 1 incx=1 incy=1 trans=n is not ok&quot;</span></div><div class="line">            <span class="keywordflow">IF</span> (y(i).NE.cy(i)) <span class="keywordflow">GOTO</span> 9997</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      print*,<span class="stringliteral">&quot;type=d dims=2x2 sym=g diag=g blocks=1x1 usmv alpha= 3&amp;</span></div><div class="line"><span class="stringliteral"></span><span class="stringliteral">       &amp; beta= 1 incx=1 incy=1 trans=n is ok&quot;</span></div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> ( res .NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keywordflow">GOTO</span> 9998</div><div class="line">9997      res = -1</div><div class="line">9998      <span class="keywordflow">CONTINUE</span></div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__free.html">rsb_mtx_free</a>(mtxap)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) res = -1 </div><div class="line"><span class="comment">! 9999      CONTINUE</span></div><div class="line">      errval=<a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>(eo)                 <span class="comment">! librsb finalization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_exit&quot;</span></div><div class="line">      print *, <span class="stringliteral">&quot;rsb module fortran test is ok&quot;</span></div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__perror.html">rsb_perror</a>(c_null_ptr,istat)</div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#a81bb92e0655a22d251331911eea093ba">rsb_mod_example1</a></div><div class="line"></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#ae69a37936a1ca7d8cf7d273b891bc57c">rsb_mod_example2</a>(res)</div><div class="line"><span class="comment">! Example using an unsymmetric matrix specified as COO, and autotuning, built piecewise.</span></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: errval</div><div class="line">      <span class="keywordtype">INTEGER</span> :: res</div><div class="line">      <span class="keywordtype">INTEGER</span> :: transt = <a class="code" href="namespacersb.html#a89c7627f24fecaf23ead8300f671314f">rsb_transposition_n</a>  <span class="comment">! no transposition</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: incx = 1, incb = 1        <span class="comment">! X, B vectors increment</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: alpha = 3,beta = 1</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nnza = 4, nra = 3, nca = 3     <span class="comment">! nonzeroes, rows, columns of matrix A</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ia(4) = (/1, 2, 3, 3/)  <span class="comment">! row    indices</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ja(4) = (/1, 2, 1, 3/)  <span class="comment">! column indices</span></div><div class="line">      <span class="keywordtype">INTEGER(C_SIGNED_CHAR)</span> :: typecode = <a class="code" href="namespacersb.html#af833bb7a31acb188d33424c3c16bd4cd">rsb_numerical_type_double</a></div><div class="line">      <span class="keywordtype">INTEGER</span> :: flags =<a class="code" href="namespacersb.html#a16cc953b0faf8ba964ba79930b51f93c">rsb_flag_default_matrix_flags</a>+<a class="code" href="namespacersb.html#a8325109ecda447aa1e93e8d747673f4c">rsb_flag_symmetric</a></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: va(4) = (/11.0, 22.0, 13.0, 33.0/) <span class="comment">! coefficients</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: x(3) = (/   0,    0,    0/)</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: b(3) = (/-1.0, -2.0, -2.0/)</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">TARGET</span>  :: mtxap = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr)  :: mtxapp = c_null_ptr</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: etime = 0.0</div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: EO = RSB_NULL_EXIT_OPTIONS</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: IO = RSB_NULL_INIT_OPTIONS</span></div><div class="line">      <span class="comment">! Note: using C_NULL_PTR instead of the previous lines because of http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59411</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: eo = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: io = c_null_ptr</div><div class="line"></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>(io)                <span class="comment">! librsb initialization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_init&quot;</span></div><div class="line"><span class="preprocessor">#if defined(__GNUC__) &amp;&amp; (__GNUC__ == 4) &amp;&amp; (__GNUC_MINOR__ &lt; 5)</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#define RSB_SKIP_BECAUSE_OLD_COMPILER 1</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#ifndef RSB_SKIP_BECAUSE_OLD_COMPILER</span></div><div class="line"><span class="preprocessor"></span>      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__alloc__from__coo__begin.html">rsb_mtx_alloc_from_coo_begin</a>(nnza,typecode,nra,nca,flags,&amp;</div><div class="line">       &amp; c_loc(errval)) <span class="comment">! begin matrix creation</span></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__mtx__set__vals.html">rsb_mtx_set_vals</a>(mtxap,&amp;</div><div class="line">       &amp; c_loc(va),c_loc(ia),c_loc(ja),nnza,flags) <span class="comment">! insert some nonzeroes</span></div><div class="line">      mtxapp = c_loc(mtxap) <span class="comment">! Old compilers like e.g.: Gfortran 4.4.7 will NOT compile this.</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_mtx_set_vals&quot;</span></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__mtx__alloc__from__coo__end.html">rsb_mtx_alloc_from_coo_end</a>(mtxapp)                   <span class="comment">! end matrix creation</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_mtx_alloc_from_coo_end&quot;</span></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__spmv.html">rsb_spmv</a>(transt,c_loc(alpha),mtxap,c_loc(x),&amp;</div><div class="line">       &amp; incx,c_loc(beta),c_loc(b),incb) <span class="comment">! X := X + (3) * A * B </span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_spmv&quot;</span></div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__free.html">rsb_mtx_free</a>(mtxap)                                 <span class="comment">! destroy matrix</span></div><div class="line"></div><div class="line">      <span class="comment">! The following is optional and depends on configure options, so it is allowed to fail</span></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__lib__get__opt.html">rsb_lib_get_opt</a>(<a class="code" href="namespacersb.html#a565392da24b3006eaeaf5c0d1c5a424d">rsb_io_want_librsb_etime</a>,c_loc(etime))</div><div class="line">      <span class="keywordflow">IF</span> (errval.EQ.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; print*,<span class="stringliteral">&quot;Time spent in librsb is:&quot;</span>,etime</div><div class="line">      <span class="comment">! IF (errval.NE.0)STOP &quot;error calling rsb_lib_get_opt&quot; </span></div><div class="line">      errval = <a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a></div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_mtx_free&quot;</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor"></span>      print*,<span class="stringliteral">&quot;You have an old Fortran compiler not supporting C_LOC.&quot;</span></div><div class="line">      print*,<span class="stringliteral">&quot;Skipping a part of the test&quot;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor"></span>      errval=<a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>(eo)                 <span class="comment">! librsb finalization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_exit&quot;</span></div><div class="line">      print *, <span class="stringliteral">&quot;rsb module fortran test is ok&quot;</span></div><div class="line">      res = errval</div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#ae69a37936a1ca7d8cf7d273b891bc57c">rsb_mod_example2</a></div><div class="line"></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#ab17498c86a79e053e959b9dab423b8e9">rsb_mod_example3</a>(res)</div><div class="line"><span class="comment">! Example using a symmetric matrix specified as CSR, and autotuning, built at once.</span></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> ::res</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: istat = 0, i</div><div class="line">      <span class="keywordtype">INTEGER</span> :: transt = <a class="code" href="namespacersb.html#a89c7627f24fecaf23ead8300f671314f">rsb_transposition_n</a> <span class="comment">!</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: incx = 1, incy = 1</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: alpha = 4, beta = 1</div><div class="line"><span class="comment">! 11 21 </span></div><div class="line"><span class="comment">! 21 22 </span></div><div class="line">      <span class="comment">! declaration of VA,IP,JA </span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>, <span class="keywordtype">PARAMETER</span> :: nnz = 3</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>, <span class="keywordtype">PARAMETER</span> :: nr = 2</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>, <span class="keywordtype">PARAMETER</span> :: nc = 2</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>, <span class="keywordtype">PARAMETER</span> :: nrhs = 1</div><div class="line">      <span class="keywordtype">INTEGER</span> :: order = <a class="code" href="namespacersb.html#a8786a38b2ca41b926b8ef6092a55b8a6">rsb_flag_want_column_major_order</a> <span class="comment">! rhs layout</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: flags = <a class="code" href="namespacersb.html#a65dbcb1d6e6347e5b7e85b5aa49db90c">rsb_flag_noflags</a> + <a class="code" href="namespacersb.html#a8325109ecda447aa1e93e8d747673f4c">rsb_flag_symmetric</a> + &amp;</div><div class="line">       &amp;                 <a class="code" href="namespacersb.html#a8ca3ae90c2f8e0923f80f04e53ad2c37">rsb_flag_fortran_indices_interface</a>        <span class="comment">!  optional flags</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ip(3) = (/1, 2, 4/)</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ja(3) = (/1, 1, 2/)</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: va(3) = (/11,21,22/) <span class="comment">! lower triangle coefficients</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: x(2) = (/1, 2/)<span class="comment">! reference x </span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: cy(2) = (/215.0, 264.0/)<span class="comment">! reference cy after </span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: y(2) = (/3, 4/)<span class="comment">! y will be overwritten</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">TARGET</span> :: mtxap = c_null_ptr <span class="comment">! matrix pointer</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span> :: tmax = 2.0 <span class="comment">! tuning max time</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: titmax = 2 <span class="comment">! tuning max iterations</span></div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: ont = 0     <span class="comment">! optimal number of threads</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: eo = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: io = c_null_ptr</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: errval</div><div class="line"></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>(io)                <span class="comment">! librsb initialization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_init&quot;</span></div><div class="line"></div><div class="line">      res = 0</div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__alloc__from__csr__const.html">rsb_mtx_alloc_from_csr_const</a>(c_loc(va),c_loc(ip),c_loc(ja)&amp;</div><div class="line">       &amp;,nnz,<a class="code" href="namespacersb.html#af833bb7a31acb188d33424c3c16bd4cd">rsb_numerical_type_double</a>,nr,nc,1,1,flags,c_loc(istat))</div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char)</div><div class="line"></div><div class="line">      <span class="comment">! Structure autotuning:</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__tune__spmm.html">rsb_tune_spmm</a>(c_loc(mtxap),c_null_ptr,c_null_ptr,titmax,&amp;</div><div class="line">       &amp; tmax,&amp;</div><div class="line">       &amp; transt,c_loc(alpha),c_null_ptr,nrhs,order,c_loc(x),nr,&amp;</div><div class="line">       &amp; c_loc(beta),c_loc(y),nc)</div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      <span class="comment">! Thread count autotuning:</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__tune__spmm.html">rsb_tune_spmm</a>(c_null_ptr,c_null_ptr,c_loc(ont),titmax,&amp;</div><div class="line">       &amp; tmax,&amp;</div><div class="line">       &amp; transt,c_loc(alpha),mtxap,nrhs,order,c_loc(x),nr,c_loc(beta),&amp;</div><div class="line">       &amp; c_loc(y),nc)</div><div class="line">      print *, <span class="stringliteral">&quot;Optimal number of threads:&quot;</span>, ont</div><div class="line"></div><div class="line">      y(:) = (/3, 4/)<span class="comment">! restoring reference y (rsb_tune_spmm has overwritten it)</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      </div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__spmv.html">rsb_spmv</a>(transt,c_loc(alpha),mtxap,c_loc(x),incx,&amp;</div><div class="line">       &amp; c_loc(beta),c_loc(y),incy)</div><div class="line">      print *, y</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keywordflow">DO</span> i = 1, 2</div><div class="line">            <span class="keywordflow">IF</span> (y(i).NE.cy(i)) print *, <span class="stringliteral">&quot;type=d dims=2x2 sym=s diag=g &amp;</span></div><div class="line"><span class="stringliteral"></span><span class="stringliteral">      &amp;blocks=1x1 usmv alpha= 4 beta= 1 incx=1 incy=1 trans=n is not ok&quot;</span></div><div class="line">            <span class="keywordflow">IF</span> (y(i).NE.cy(i)) <span class="keywordflow">GOTO</span> 9997</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      print*,<span class="stringliteral">&quot;type=d dims=2x2 sym=s diag=g blocks=1x1 usmv alpha= 4&amp;</span></div><div class="line"><span class="stringliteral"></span><span class="stringliteral">       &amp; beta= 1 incx=1 incy=1 trans=n is ok&quot;</span></div><div class="line">      <span class="keywordflow">GOTO</span> 9998</div><div class="line"></div><div class="line">      errval=<a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>(eo)                 <span class="comment">! librsb finalization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_exit&quot;</span></div><div class="line">      print *, <span class="stringliteral">&quot;rsb module fortran test is ok&quot;</span></div><div class="line">9997      res = -1</div><div class="line">9998      <span class="keywordflow">CONTINUE</span></div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__free.html">rsb_mtx_free</a>(mtxap)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) res = -1 </div><div class="line"><span class="comment">! 9999      CONTINUE</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__perror.html">rsb_perror</a>(c_null_ptr,istat)</div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#ab17498c86a79e053e959b9dab423b8e9">rsb_mod_example3</a></div><div class="line"></div><div class="line">      <span class="keyword">PROGRAM</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a></div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: res = <a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>, passed = 0, failed = 0</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran__rsb__fi_8F90.html#a81bb92e0655a22d251331911eea093ba">rsb_mod_example1</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran__rsb__fi_8F90.html#ae69a37936a1ca7d8cf7d273b891bc57c">rsb_mod_example2</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran__rsb__fi_8F90.html#ab17498c86a79e053e959b9dab423b8e9">rsb_mod_example3</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line">      </div><div class="line">      print *, <span class="stringliteral">&quot;FAILED:&quot;</span>, failed</div><div class="line">      print *, <span class="stringliteral">&quot;PASSED:&quot;</span>, passed</div><div class="line">      <span class="keywordflow">IF</span> (failed.GT.0) <span class="keywordflow">THEN</span></div><div class="line">       stop 1</div><div class="line"><span class="keywordflow">      END IF</span></div><div class="line"><span class="keyword">      END PROGRAM</span></div><div class="line"></div></div><!-- fragment --><p><a class="anchor" id="examples_backsolve_c"></a> <a class="el" href="backsolve_8c.html" title="C triangular solve example program. Uses rsb_spsv(),rsb_tune_spsm(). Based on &lt;rsb.h&gt;. ">examples/backsolve.c</a>: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">Copyright (C) 2008-2021 Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">This file is part of librsb.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">(at your option) any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span><span class="comment"></span></div><div class="line"><span class="comment">/*!</span></div><div class="line"><span class="comment"> \ingroup rsb_doc_examples</span></div><div class="line"><span class="comment"> @file</span></div><div class="line"><span class="comment"> @author Michele Martone</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> @brief C triangular solve example program.</span></div><div class="line"><span class="comment">   Uses #rsb_spsv(),#rsb_tune_spsm().</span></div><div class="line"><span class="comment">   Based on &lt;rsb.h&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> \include hello.c</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rsb_8h.html">rsb.h</a>&gt;</span>        <span class="comment">/* librsb header to include */</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span>      <span class="comment">/* printf() */</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * <span class="keyword">const</span> argv[])</div><div class="line">{<span class="comment"></span></div><div class="line"><span class="comment">        /*!</span></div><div class="line"><span class="comment">          A Hello-RSB program.</span></div><div class="line"><span class="comment">         </span></div><div class="line"><span class="comment">          This program shows how to use the rsb.h interface correctly to:</span></div><div class="line"><span class="comment">         </span></div><div class="line"><span class="comment">          - initialize the library using #rsb_lib_init()</span></div><div class="line"><span class="comment">          - allocate (build) a single sparse matrix in the RSB format</span></div><div class="line"><span class="comment">            using #rsb_mtx_alloc_from_coo_const(), with implicit diagonal</span></div><div class="line"><span class="comment">          - print information obtained via #rsb_mtx_get_info_str()</span></div><div class="line"><span class="comment">          - multiply the triangular matrix using #rsb_spmv()</span></div><div class="line"><span class="comment">          - autotune the matrix for rsb_spsv with #rsb_tune_spsm()</span></div><div class="line"><span class="comment">          - solve the triangular system using #rsb_spsv()</span></div><div class="line"><span class="comment">          - deallocate the matrix using #rsb_mtx_free() </span></div><div class="line"><span class="comment">          - finalize the library using #rsb_lib_exit()</span></div><div class="line"><span class="comment">         </span></div><div class="line"><span class="comment">          In this example, we use #RSB_DEFAULT_TYPE as matrix type.</span></div><div class="line"><span class="comment">          This type depends on what was configured at library build time.</span></div><div class="line"><span class="comment">         * */</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> bs = <a class="code" href="rsb_8h.html#a3579d00f3b97cd569707f7c62e462322">RSB_DEFAULT_BLOCKING</a>;</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> brA = bs, bcA = bs;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> one = 1;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#ac0f6a03345c8874f6e50f0ed033d984b">rsb_type_t</a> typecode = <a class="code" href="rsb__types_8h.html#a56fc5ef14266266227797621e0a1e217">RSB_NUMERICAL_TYPE_DEFAULT</a>;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a46b3366e54a5b4dda754a6ace22264df">rsb_nnz_idx_t</a> nnzA = 7;           <span class="comment">/* matrix nonzeroes count */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> nrA = 6;            <span class="comment">/* matrix rows count */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> ncA = 6;            <span class="comment">/* matrix columns count */</span></div><div class="line">        <span class="comment">/* nonzero row indices coordinates: */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> IA[] = {1,2,3,4,5,6,1};</div><div class="line">        <span class="comment">/* nonzero column indices coordinates: */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#a4874ba61df0ff15b4395278496f83a5d">rsb_coo_idx_t</a> JA[] = {1,2,3,4,5,6,6};</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> VA[] = {1,1,1,1,1,1,1};<span class="comment">/*values of nonzeroes*/</span></div><div class="line">        <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> X[] = { 0,0,0,0,0,0 }; <span class="comment">/* X vector&#39;s array */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb__types_8h.html#aa5e96f00841ec8f4f3ca1ff0bf1b5bbd">RSB_DEFAULT_TYPE</a> B[] = { 1,1,1,1,1,1 }; <span class="comment">/* B */</span></div><div class="line">        <span class="keyword">struct </span>rsb_mtx_t *mtxAp = NULL; <span class="comment">/* matrix structure pointer */</span></div><div class="line">        <span class="keywordtype">char</span> ib[200];</div><div class="line">        <span class="keywordtype">int</span> i;</div><div class="line">        <a class="code" href="rsb_8h.html#a640e84bcc5268cd92d5d31fd6ac321b8">rsb_err_t</a> errval = <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>;</div><div class="line">        <span class="keyword">const</span> <a class="code" href="rsb_8h.html#aefcdc7de885ab34a89a0d36470e11deb">rsb_int_t</a> wvat = 1; <span class="comment">/* want verbose autotuning; see </span></div><div class="line"><span class="comment">                  documentation of RSB_IO_WANT_VERBOSE_TUNING */</span></div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Hello, RSB!\n&quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;Initializing the library...\n&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>((errval = <a class="code" href="group__rsb__doc__rsb.html#gaf2b874d9f117ee6a6899634472b17946">rsb_lib_init</a>(<a class="code" href="rsb_8h.html#add105c42e570c5c269680d437f8c51e2">RSB_NULL_INIT_OPTIONS</a>)) != </div><div class="line">                        <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error initializing the library!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly initialized the library.\n&quot;</span>);</div><div class="line"></div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga2a08c5a23f3999fe8cf36440680e4a05">rsb_lib_set_opt</a>(<a class="code" href="group__rsb__doc__rsb.html#ggae0bada88731b01751401847d60110fb6a2164b61bd47cf53a3c8d287b419ab591">RSB_IO_WANT_VERBOSE_TUNING</a>, &amp;wvat );</div><div class="line">        <span class="keywordflow">if</span>( (errval) != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error setting option!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        mtxAp = <a class="code" href="group__rsb__doc__rsb.html#ga86c1b0d0586f817ee31ca1caa3fee9be">rsb_mtx_alloc_from_coo_const</a>(</div><div class="line">                VA,IA,JA,nnzA,typecode,nrA,ncA,brA,bcA,</div><div class="line">                <a class="code" href="rsb_8h.html#a17c314e28220f3b81aed9cc7d79f97e4">RSB_FLAG_DEFAULT_RSB_MATRIX_FLAGS</a> <span class="comment">/* force rsb */</span></div><div class="line">                | <a class="code" href="rsb_8h.html#afd1b39c625f4249cd32fccea38957f97">RSB_FLAG_DUPLICATES_SUM</a><span class="comment">/* sum dups */</span></div><div class="line">                | <a class="code" href="rsb_8h.html#a4af24812309eb471c861ba618cb996f2">RSB_FLAG_UNIT_DIAG_IMPLICIT</a><span class="comment">/* ask diagonal implicit */</span></div><div class="line">                | <a class="code" href="rsb_8h.html#adca72e259846399da3512fcb062ad518">RSB_FLAG_TRIANGULAR</a> <span class="comment">/* need triangle for spsv */</span></div><div class="line">                | <a class="code" href="rsb_8h.html#a8ccb4d7203ce7707f9d13bd6c5ef4169">RSB_FLAG_FORTRAN_INDICES_INTERFACE</a> <span class="comment">/* treat indices as 1-based */</span></div><div class="line">                , &amp;errval);</div><div class="line">        <span class="keywordflow">if</span>((!mtxAp) || (errval != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>))</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error while allocating the matrix!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly allocated a matrix with %ld nonzeroes.\n&quot;</span>,</div><div class="line">                (<span class="keywordtype">long</span> <span class="keywordtype">int</span>)nnzA);</div><div class="line">        printf(<span class="stringliteral">&quot;Summary information of the matrix:\n&quot;</span>);</div><div class="line">        <span class="comment">/* print out the matrix summary information  */</span></div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#ga2b7d51b9822f73d2fe7fcf5b9d0be1e9">rsb_mtx_get_info_str</a>(mtxAp,<span class="stringliteral">&quot;RSB_MIF_MATRIX_INFO__TO__CHAR_P&quot;</span>,</div><div class="line">                        ib,<span class="keyword">sizeof</span>(ib));</div><div class="line">        printf(<span class="stringliteral">&quot;%s&quot;</span>,ib);</div><div class="line">        printf(<span class="stringliteral">&quot;\nMatrix printout:\n&quot;</span>);</div><div class="line"></div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gad911ac7528c95c874d02cb17e6b76c54">rsb_file_mtx_save</a>(mtxAp, NULL);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>((errval = </div><div class="line">                <a class="code" href="group__rsb__doc__rsb.html#ga4a16a82d289c76a437915db449553d4d">rsb_spmv</a>(<a class="code" href="rsb__types_8h.html#a9673f34330af77b1c0fd4a585e0c62cc">RSB_TRANSPOSITION_N</a>,&amp;one,mtxAp,B,1,&amp;one,X,1))</div><div class="line">                        != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error performing a multiplication!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;\nWe have a unitary vector:\n&quot;</span>);</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gac4b2a63cdfe1cd4083b1561ee4bea696">rsb_file_vec_save</a>(NULL, typecode, B, nrA);</div><div class="line">        </div><div class="line">        printf(<span class="stringliteral">&quot;\nMultiplying matrix by unitary vector we get:\n&quot;</span>);</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gac4b2a63cdfe1cd4083b1561ee4bea696">rsb_file_vec_save</a>(NULL, typecode, X, nrA);</div><div class="line"></div><div class="line">        errval = <a class="code" href="group__rsb__doc__rsb.html#ga8d7a05bbc165bd6ac20e8e23487a5871">rsb_tune_spsm</a>(&amp;mtxAp, NULL, NULL, 0, 0, <a class="code" href="rsb__types_8h.html#a9673f34330af77b1c0fd4a585e0c62cc">RSB_TRANSPOSITION_N</a>,</div><div class="line">                &amp;one, NULL, 1, <a class="code" href="rsb_8h.html#a6ed7790c2f7129a6e051b8167c48a43c">RSB_FLAG_WANT_COLUMN_MAJOR_ORDER</a>, NULL, nrA,</div><div class="line">                 NULL, NULL, nrA);</div><div class="line">        <span class="keywordflow">if</span>( (errval) != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error performing autotuning!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>((errval = <a class="code" href="group__rsb__doc__rsb.html#ga9b044332b720d3f8083ae792068fb04a">rsb_spsv</a>(<a class="code" href="rsb__types_8h.html#a9673f34330af77b1c0fd4a585e0c62cc">RSB_TRANSPOSITION_N</a>,&amp;one,mtxAp,X,1,X,1))</div><div class="line">                        != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a> )</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error performing triangular solve!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;\nBacksolving we should get a unitary vector:\n&quot;</span>);</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gac4b2a63cdfe1cd4083b1561ee4bea696">rsb_file_vec_save</a>(NULL, typecode, X, nrA);</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span>(i=0;i&lt;nrA;++i)</div><div class="line">                <span class="keywordflow">if</span>(X[i]!=one)</div><div class="line">                {</div><div class="line">                        printf(<span class="stringliteral">&quot;Warning! Result vector not unitary!:\n&quot;</span>);</div><div class="line">                        errval = <a class="code" href="rsb_8h.html#a8e650a7e3b5c5aa1fb9763b0f1498126">RSB_ERR_INTERNAL_ERROR</a>;</div><div class="line">                        <span class="keywordflow">goto</span> err;</div><div class="line">                }</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;All done.\n&quot;</span>);</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab64a020286a8b58d23d84d4512bd9132">rsb_mtx_free</a>(mtxAp);</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly freed the matrix.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>((errval = <a class="code" href="group__rsb__doc__rsb.html#ga86db30487afe975ed18a7aa6ee0db81d">rsb_lib_exit</a>(<a class="code" href="rsb_8h.html#a2234a5e51156de6c95c3f8c2951ae09f">RSB_NULL_EXIT_OPTIONS</a>))</div><div class="line">                        != <a class="code" href="rsb_8h.html#a1ad3f986b2e84249785751bf42ff3f8a">RSB_ERR_NO_ERROR</a>)</div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;Error finalizing the library!\n&quot;</span>);</div><div class="line">                <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;Correctly finalized the library.\n&quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;Program terminating with no error.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">err:</div><div class="line">        <a class="code" href="group__rsb__doc__rsb.html#gab660cf8aff876ae88b59c7a22ddfc912">rsb_perror</a>(NULL,errval);</div><div class="line">        printf(<span class="stringliteral">&quot;Program terminating with error.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div><div class="line">}</div><div class="line"></div></div><!-- fragment --><p><a class="anchor" id="examples_snippets_c"></a> <a class="anchor" id="examples_bench_sh"></a> examples/bench.sh: </p><div class="fragment"><div class="line">#!/bin/bash</div><div class="line">#</div><div class="line"># Copyright (C) 2008-2022 Michele Martone</div><div class="line"># </div><div class="line"># This file is part of librsb.</div><div class="line"># </div><div class="line"># librsb is free software; you can redistribute it and/or modify it</div><div class="line"># under the terms of the GNU Lesser General Public License as published</div><div class="line"># by the Free Software Foundation; either version 3 of the License, or</div><div class="line"># (at your option) any later version.</div><div class="line"># </div><div class="line"># librsb is distributed in the hope that it will be useful, but WITHOUT</div><div class="line"># ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</div><div class="line"># FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</div><div class="line"># License for more details.</div><div class="line"># </div><div class="line"># You should have received a copy of the GNU Lesser General Public</div><div class="line"># License along with librsb; see the file COPYING.</div><div class="line"># If not, see &lt;http://www.gnu.org/licenses/&gt;.</div><div class="line"></div><div class="line"># Benchmark rsbench and postprocess results.</div><div class="line"># \ingroup rsb_doc_examples</div><div class="line"># @file</div><div class="line"># @author Michele Martone</div><div class="line"># @brief Benchmark invocation from shell script.</div><div class="line">#</div><div class="line">set -e</div><div class="line">set -x</div><div class="line">which rsbench</div><div class="line">BRF=test.rpr</div><div class="line"># invoke rsbench and produce a performance record, using all types and one thread</div><div class="line">rsbench -oa -Ob --bench --lower 100 --as-symmetric \</div><div class="line">        --types &#39;:&#39; -n 1 \</div><div class="line">        --notranspose --compare-competitors \</div><div class="line">        --verbose --verbose \</div><div class="line">        --write-performance-record=${BRF}</div><div class="line"></div><div class="line"># examine tuning renderings (produced by --verbose --verbose)</div><div class="line">ls -ltr ${BRF/.rpr/}-tuning*</div><div class="line"></div><div class="line"># convert the performance record to text form</div><div class="line">rsbench --read-performance-record ${BRF} &gt; ${BRF/rpr/txt}</div><div class="line">ls -ltr ${BRF/rpr/txt}</div><div class="line"></div><div class="line"># convert the performance record to LaTeX table document form</div><div class="line">RSB_PR_WLTC=2 RSB_PR_SR=0 \</div><div class="line"> rsbench --read-performance-record ${BRF} &gt; ${BRF/rpr/tex}</div><div class="line">which latex || exit 0 # to compile LaTeX document</div><div class="line">which kpsepath || exit 0 # to check LaTeX packages</div><div class="line">find `kpsepath tex | sed &#39;s/!!//g;s/:/\n/g;&#39;` -name sciposter.cls || exit 0 # need sciposter class, usually in texlive-science</div><div class="line">find `kpsepath tex | sed &#39;s/!!//g;s/:/\n/g;&#39;` -name translator.sty || exit 0 # need sciposter class, usually in texlive-latex-recommended</div><div class="line"></div><div class="line"># convert the LaTeX table into a DVI (may as well use pdflatex for PDF)</div><div class="line">latex -interaction=batchmode -file-line-error ${BRF/rpr/tex}</div><div class="line"></div><div class="line"># convert the performance record to GNUPLOT plots</div><div class="line">which gnuplot || exit 0</div><div class="line">RSB_PRD_STYLE_PLT_PFN=${BRF/rpr/} RSB_PRD_STYLE_PLT_FMT=1 RSB_PR_SR=2 \</div><div class="line"> rsbench --read-performance-record ${BRF} &gt; ${BRF/rpr/gnu}</div><div class="line"></div><div class="line"># convert the GNUPLOT plots into PDF</div><div class="line">ls -ltr ${BRF/rpr/gnu}</div><div class="line">gnuplot ${BRF/rpr/gnu}</div><div class="line"></div><div class="line"># convert the performance record to GNUPLOT plots, different way</div><div class="line">RSB_PRD_STYLE_PLT_PFN=${BRF/rpr/} RSB_PRD_STYLE_PLT_FMT=  RSB_PR_SR=2 \</div><div class="line"> rsbench --read-performance-record ${BRF} &gt; ${BRF/rpr/gnu}</div><div class="line">gnuplot ${BRF/rpr/gnu}</div><div class="line">ls -ltr ${BRF/.rpr/}*.png</div><div class="line">ls -ltr ${BRF/.rpr/}*.eps</div><div class="line">ls -ltr ${BRF} ${BRF/rpr/tex} ${BRF/rpr/dvi} ${BRF/rpr/txt}</div><div class="line"></div><div class="line"># clean up</div><div class="line">rm ${BRF/rpr/}{aux,log,out,gnu}</div><div class="line">rm ${BRF/.rpr/}*{.png,.eps}</div><div class="line">rm      ${BRF} ${BRF/rpr/tex} ${BRF/rpr/dvi} ${BRF/rpr/txt}</div><div class="line">exit</div><div class="line"></div></div><!-- fragment --><p>Most of the snippets in the documentation come from <a class="el" href="snippets_8c.html" title="Collection of C snippets of other examples. Used piecewise the documentation. Not intended to be read...">examples/snippets.c</a>. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
